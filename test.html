<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Tr√¨nh ƒë·ªçc Kinh NikƒÅya</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --muted:#64748b;
      --accent:#2563eb;
      --border:#e2e8f0;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:#0f172a;
    }

    .app{
      max-width:960px;
      margin:0 auto;
      padding:10px;
    }

    .card{
      background:var(--card);
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.4);
      box-shadow:0 12px 30px rgba(15,23,42,0.12);
      padding:10px 14px 14px;
      display:flex;
      flex-direction:column;
      min-height:80vh;
      position:relative;
    }

    /* HEADER */
    .header{
      border-bottom:1px solid rgba(148,163,184,0.25);
      padding-bottom:6px;
      margin-bottom:6px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }

    .header-main{
      flex:1 1 auto;
      min-width:0;
    }

    #title{
      margin:0;
      font-size:1.05rem;
      font-weight:800;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:var(--accent);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    #subtitle{
      margin-top:3px;
      font-size:12.5px;
      color:var(--muted);
    }

    /* TOOLBAR */
    .toolbar{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:6px;
    }

    .lang-buttons,
    .view-buttons,
    .tts-buttons{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .toolbar button{
      height:30px;
      min-width:46px;
      padding:0 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.9);
      background:#f8fafc;
      font-size:12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      white-space:nowrap;
    }

    .toolbar button.active{
      background:var(--accent);
      color:#fff;
      border-color:var(--accent);
    }

    .icon-btn{
      width:30px;
      min-width:30px;
      padding:0;
      border-radius:10px;
    }

    /* GRID */
    #sutraGrid{
      margin-top:8px;
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      gap:8px;
      max-height:70vh;
      overflow:auto;
      padding:8px 4px 40px;
    }

    .sutra-row{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:8px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.25);
      background:#ffffff;
      position:relative;
    }

    .sutra-col{
      font-size:13.5px;
      line-height:1.7;
    }

    .pali{font-family:"Noto Serif",serif;font-size:14.5px;}
    .eng{font-family:Georgia,serif;}
    .vie{font-family:system-ui;}

    .col-head{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.05em;
      color:var(--muted);
      margin-bottom:3px;
      font-weight:600;
    }

    .hide-pali .pali-col{display:none;}
    .hide-eng  .eng-col {display:none;}
    .hide-vie  .vie-col {display:none;}

    .stack .sutra-row{grid-template-columns:1fr;}

    /* Highlight d√≤ng ƒëang ƒë·ªçc */
    .sutra-row.reading{
      background:#ffffff;
      border:2px solid rgba(37,99,235,0.95);
      box-shadow:0 0 0 3px rgba(191,219,254,0.9);
      z-index:1;
    }

    /* FLOATING BUTTONS */
    .fab{
      position:fixed;
      bottom:14px;
      width:36px;
      height:36px;
      border-radius:10px;
      border:1px solid rgba(148,163,184,0.8);
      background:#f8fafc;
      color:#0f172a;
      font-size:18px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 4px 12px rgba(15,23,42,0.3);
      z-index:1300;
    }

    #btnBackTop{
      right:14px;
      opacity:0;
      pointer-events:none;
    }
    #btnBackTop.show{
      opacity:1;
      pointer-events:auto;
    }

    #btnSettingsFloat{
      right:56px;
    }

    #btnMenu{
      right:98px;
    }

    /* PANEL MENU (SLIDER + ACCORDION) */
    #menuPanel{
      position:fixed;
      right:14px;
      bottom:60px;
      width:260px;
      max-height:70vh;
      background:#ffffff;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.7);
      box-shadow:0 12px 30px rgba(15,23,42,0.35);
      padding:6px 8px 8px;
      font-size:12px;
      display:none;
      opacity:0;
      transform:translateY(6px);
      pointer-events:none;
      z-index:1250;
    }
    #menuPanel.open{
      display:block;
      opacity:1;
      transform:translateY(0);
      pointer-events:auto;
      transition:opacity .2s ease, transform .2s ease;
    }

    .menu-header{
      padding:4px 2px 6px;
      border-bottom:1px solid rgba(148,163,184,0.35);
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .menu-header strong{
      font-size:12px;
    }

    .menu-slider{
      margin-bottom:6px;
    }

    .menu-slider label{
      display:flex;
      justify-content:space-between;
      font-size:11.5px;
      color:var(--muted);
      margin-bottom:2px;
    }

    .menu-slider input[type="range"]{
      width:100%;
    }

    .acc-container{
      max-height:calc(70vh - 70px);
      overflow:auto;
    }

    .acc-section{
      border-radius:8px;
      margin-bottom:4px;
      overflow:hidden;
    }

    .acc-sec-header{
      padding:5px 6px;
      background:#f1f5f9;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11.5px;
      font-weight:600;
    }
    .acc-sec-header span.arrow{
      font-size:10px;
      opacity:0.7;
      margin-left:4px;
    }

    .acc-sec-body{
      display:none;
      padding:4px 4px 4px 8px;
      background:#ffffff;
      border-top:1px solid rgba(148,163,184,0.3);
    }

    .acc-section.open > .acc-sec-body{
      display:block;
    }

    .acc-group{
      margin-bottom:3px;
    }

    .acc-group-header{
      font-size:11.5px;
      color:#475569;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:3px 2px;
    }
    .acc-group-header span.arrow{
      font-size:9px;
      opacity:0.7;
    }

    .acc-group-body{
      display:none;
      padding-left:4px;
    }
    .acc-group.open > .acc-group-body{
      display:block;
    }

    .sutra-list{
      list-style:none;
      margin:2px 0 0;
      padding:0;
    }
    .sutra-list li{margin:0;}

    .sutra-link{
      display:block;
      padding:3px 4px;
      border-radius:6px;
      font-size:11.5px;
      text-decoration:none;
      color:#0f172a;
      cursor:pointer;
    }
    .sutra-link small{
      display:block;
      font-size:10px;
      color:#64748b;
    }
    .sutra-link:hover{
      background:#e0ecff;
    }
    .sutra-link.active{
      background:#2563eb;
      color:#ffffff;
    }
    .sutra-link.active small{
      color:#dbeafe;
    }

    @media(max-width:768px){
      .card{
        padding:10px;
        min-height:calc(100vh - 20px);
      }
      .header{
        flex-direction:column;
        align-items:flex-start;
      }
      .toolbar{
        align-items:flex-start;
      }
      #menuPanel{
        right:10px;
        width:80%;
        max-width:280px;
      }
      .sutra-row{
        grid-template-columns:1fr;
      }
    }

    @media(max-width:500px){
      .sutra-row{
        grid-template-columns:1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card" id="card">
      <div class="header">
        <div class="header-main">
          <h1 id="title">Ch∆∞a ch·ªçn b√†i</h1>
          <div id="subtitle">‚Äî</div>
        </div>
        <div class="toolbar">
          <div class="lang-buttons">
            <button id="btnPali" class="active">PLI</button>
            <button id="btnEng"  class="active">EN</button>
            <button id="btnVie"  class="active">VI</button>
          </div>
          <div class="view-buttons">
            <button id="btnStack" class="icon-btn" title="X·∫øp d·ªçc">‚â°</button>
          </div>
          <div class="tts-buttons">
            <button id="btnReadVie">üîä VI</button>
            <button id="btnReadEng">üîä EN</button>
            <button id="btnStopTTS" class="icon-btn" title="D·ª´ng">‚èπ</button>
          </div>
        </div>
      </div>

      <div id="sutraGrid"></div>
    </div>
  </div>

  <!-- FLOATING BUTTONS -->
  <button id="btnMenu" class="fab" title="Danh m·ª•c / slider">üìú</button>
  <button id="btnSettingsFloat" class="fab" title="·∫®n/hi·ªán toolbar">‚öô</button>
  <button id="btnBackTop" class="fab" title="L√™n ƒë·∫ßu">‚Üë</button>

  <!-- MENU PANEL -->
  <div id="menuPanel" aria-hidden="true">
    <div class="menu-header">
      <strong>Ch·ªçn b√†i kinh</strong>
      <span id="currentCode" style="font-size:11px;color:#64748b;"></span>
    </div>
    <div class="menu-slider">
      <label>
        <span>B√†i</span>
        <span id="sliderLabel">‚Äî</span>
      </label>
      <input id="sutraSlider" type="range" min="1" max="1" value="1">
    </div>
    <div class="acc-container" id="accContainer">
      <!-- accordion s·∫Ω ƒë∆∞·ª£c JS build -->
    </div>
  </div>

  <!-- LOAD DATA -->
  <script src="sutra-tree.js"></script>

  <script>
  (function(){
    'use strict';

    // ELEMENTS
    const card         = document.getElementById('card');
    const titleEl      = document.getElementById('title');
    const subtitleEl   = document.getElementById('subtitle');
    const grid         = document.getElementById('sutraGrid');

    const btnPali      = document.getElementById('btnPali');
    const btnEng       = document.getElementById('btnEng');
    const btnVie       = document.getElementById('btnVie');
    const btnStack     = document.getElementById('btnStack');

    const btnReadVie   = document.getElementById('btnReadVie');
    const btnReadEng   = document.getElementById('btnReadEng');
    const btnStopTTS   = document.getElementById('btnStopTTS');

    const btnMenu      = document.getElementById('btnMenu');
    const btnSettingsFloat = document.getElementById('btnSettingsFloat');
    const btnBackTop   = document.getElementById('btnBackTop');

    const menuPanel    = document.getElementById('menuPanel');
    const accContainer = document.getElementById('accContainer');
    const sutraSlider  = document.getElementById('sutraSlider');
    const sliderLabel  = document.getElementById('sliderLabel');
    const currentCodeEl = document.getElementById('currentCode');

    let showPali = true;
    let showEng  = true;
    let showVie  = true;
    let sutraRows = [];

    // DATA FLAT LIST
    let FLAT_SUTRAS = []; // [{id, code, title, content, _sectionId, _groupId}]
    let currentIndex = 0;

    // ==== FLATTEN TREE ====
    function buildFlatList(){
      FLAT_SUTRAS = [];
      if(!window.SUTRA_TREE) return;

      window.SUTRA_TREE.forEach(sec=>{
        (sec.groups || []).forEach(g=>{
          (g.suttas || []).forEach(s=>{
            FLAT_SUTRAS.push({
              id: s.id,
              code: s.code,
              title: s.title,
              content: s.content,
              _sectionId: sec.id,
              _groupId: g.id
            });
          });
        });
      });
    }

    function findIndexById(id){
      return FLAT_SUTRAS.findIndex(s => s.id === id);
    }

    /* ========== RENDER SUTRA ========== */
    function renderSutraByIndex(idx){
      if(idx < 0 || idx >= FLAT_SUTRAS.length) return;
      currentIndex = idx;

      const data = FLAT_SUTRAS[idx];
      const content = data.content;
      if(!content) return;

      titleEl.textContent    = content.title || data.code;
      subtitleEl.textContent = content.subtitle || data.title || '';

      // build HTML m·ªôt l·∫ßn
      let html = '';
      (content.rows || []).forEach((row, i)=>{
        html += `
          <div class="sutra-row" data-idx="${i+1}">
            <div class="sutra-col pali-col">
              <div class="col-head">PƒÅli</div>
              <div class="pali">${row.pali || ''}</div>
            </div>
            <div class="sutra-col eng-col">
              <div class="col-head">English</div>
              <div class="eng">${row.eng || ''}</div>
            </div>
            <div class="sutra-col vie-col">
              <div class="col-head">Ti·∫øng Vi·ªát</div>
              <div class="vie">${row.vie || ''}</div>
            </div>
          </div>
        `;
      });

      grid.innerHTML = html;
      sutraRows = Array.from(grid.querySelectorAll('.sutra-row'));

      // c·∫≠p nh·∫≠t layout + menu tr·∫°ng th√°i
      applyVisibility();
      updateSliderFromIndex();
      highlightActiveLink();
      stopAllSpeech();
      grid.scrollTop = 0;
      toggleBackTop(false);
    }

    /* ========== LAYOUT / VISIBILITY ========== */
    function adjustRowColumns(){
      const rows = grid.querySelectorAll('.sutra-row');
      const isNarrow = window.innerWidth <= 500;
      rows.forEach(row=>{
        if(card.classList.contains('stack') || isNarrow){
          row.style.gridTemplateColumns = '1fr';
          return;
        }
        let count = 0;
        if(showPali) count++;
        if(showEng)  count++;
        if(showVie)  count++;
        count = Math.max(1, count);
        row.style.gridTemplateColumns = `repeat(${count}, 1fr)`;
      });
    }

    function applyVisibility(){
      grid.classList.toggle('hide-pali', !showPali);
      grid.classList.toggle('hide-eng',  !showEng);
      grid.classList.toggle('hide-vie',  !showVie);
      adjustRowColumns();
    }

    window.addEventListener('resize', adjustRowColumns);

    btnPali.addEventListener('click', ()=>{
      showPali = !showPali;
      btnPali.classList.toggle('active', showPali);
      applyVisibility();
    });
    btnEng.addEventListener('click', ()=>{
      showEng = !showEng;
      btnEng.classList.toggle('active', showEng);
      applyVisibility();
    });
    btnVie.addEventListener('click', ()=>{
      showVie = !showVie;
      btnVie.classList.toggle('active', showVie);
      applyVisibility();
    });

    btnStack.addEventListener('click', ()=>{
      card.classList.toggle('stack');
      btnStack.classList.toggle('active', card.classList.contains('stack'));
      adjustRowColumns();
    });

    /* ========== MENU (SLIDER + ACCORDION) ========== */
    function buildAccordion(){
      if(!window.SUTRA_TREE){
        accContainer.innerHTML = '<div class="text-muted small">Ch∆∞a c√≥ danh s√°ch.</div>';
        return;
      }

      let html = '';
      window.SUTRA_TREE.forEach(sec=>{
        html += `
          <div class="acc-section" data-section-id="${sec.id}">
            <div class="acc-sec-header">
              <span>${sec.label}</span>
              <span class="arrow">‚ñæ</span>
            </div>
            <div class="acc-sec-body">
        `;
        (sec.groups || []).forEach(g=>{
          html += `
            <div class="acc-group" data-group-id="${g.id}">
              <div class="acc-group-header">
                <span>${g.label}</span>
                <span class="arrow">‚ñæ</span>
              </div>
              <div class="acc-group-body">
                <ul class="sutra-list">
          `;
          (g.suttas || []).forEach(s=>{
            html += `
              <li>
                <a class="sutra-link"
                   data-id="${s.id}">
                  <strong>${s.code}</strong>
                  <small>${s.title}</small>
                </a>
              </li>
            `;
          });
          html += `
                </ul>
              </div>
            </div>
          `;
        });
        html += `
            </div>
          </div>
        `;
      });

      accContainer.innerHTML = html;

      // events section
      accContainer.querySelectorAll('.acc-sec-header').forEach(h=>{
        h.addEventListener('click', ()=>{
          const sec = h.parentElement;
          const isOpen = sec.classList.contains('open');
          accContainer.querySelectorAll('.acc-section').forEach(s=>s.classList.remove('open'));
          if(!isOpen) sec.classList.add('open');
        });
      });

      // events group
      accContainer.querySelectorAll('.acc-group-header').forEach(gh=>{
        gh.addEventListener('click', ()=>{
          const g = gh.parentElement;
          const isOpen = g.classList.contains('open');
          const body = g.closest('.acc-sec-body');
          if(body){
            body.querySelectorAll('.acc-group').forEach(x=>x.classList.remove('open'));
          }
          if(!isOpen) g.classList.add('open');
        });
      });

      // sutra link click
      accContainer.querySelectorAll('.sutra-link').forEach(link=>{
        link.addEventListener('click', (e)=>{
          e.preventDefault();
          const id = Number(link.dataset.id);
          const idx = findIndexById(id);
          if(idx >= 0){
            renderSutraByIndex(idx);
            menuPanel.classList.remove('open');
            menuPanel.setAttribute('aria-hidden','true');
          }
        });
      });
    }

    function highlightActiveLink(){
      const current = FLAT_SUTRAS[currentIndex];
      if(!current) return;
      const id = current.id;

      accContainer.querySelectorAll('.sutra-link').forEach(a=>{
        const match = Number(a.dataset.id) === id;
        a.classList.toggle('active', match);
      });

      currentCodeEl.textContent = current.code || '';
    }

    // slider
    function initSlider(){
      if(!FLAT_SUTRAS.length) return;
      sutraSlider.min = 1;
      sutraSlider.max = FLAT_SUTRAS.length;
      sutraSlider.value = currentIndex + 1;
      updateSliderLabel();
    }

    function updateSliderLabel(){
      const s = FLAT_SUTRAS[currentIndex];
      if(!s){
        sliderLabel.textContent = '‚Äî';
        return;
      }
      sliderLabel.textContent = `${s.code} ‚Äì ${s.title}`;
    }

    function updateSliderFromIndex(){
      sutraSlider.value = currentIndex + 1;
      updateSliderLabel();
    }

    sutraSlider.addEventListener('input', ()=>{
      const idx = Number(sutraSlider.value) - 1;
      if(idx >= 0 && idx < FLAT_SUTRAS.length){
        currentIndex = idx;
        updateSliderLabel();
      }
    });

    sutraSlider.addEventListener('change', ()=>{
      const idx = Number(sutraSlider.value) - 1;
      if(idx >= 0 && idx < FLAT_SUTRAS.length){
        renderSutraByIndex(idx);
      }
    });

    btnMenu.addEventListener('click', ()=>{
      const isOpen = menuPanel.classList.toggle('open');
      menuPanel.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
    });

    // toggle toolbar b·∫±ng n√∫t ‚öô
    btnSettingsFloat.addEventListener('click', ()=>{
      const headerToolbar = document.querySelector('.toolbar');
      if(!headerToolbar) return;
      const hidden = headerToolbar.style.display === 'none';
      headerToolbar.style.display = hidden ? 'flex' : 'none';
    });

    /* ========== BACK TO TOP ========== */
    function toggleBackTop(show){
      btnBackTop.classList.toggle('show', show);
    }

    grid.addEventListener('scroll', ()=>{
      toggleBackTop(grid.scrollTop > 0);
    });

    btnBackTop.addEventListener('click', ()=>{
      grid.scrollTo({top:0, behavior:'smooth'});
    });

    /* ========== TTS + HIGHLIGHT ========== */
    const synthSupported = 'speechSynthesis' in window;
    const synth = synthSupported ? window.speechSynthesis : null;
    let voices = [];

    function loadVoices(){
      if(!synthSupported) return;
      voices = synth.getVoices() || [];
    }
    if(synthSupported){
      loadVoices();
      if(typeof speechSynthesis.onvoiceschanged !== 'undefined'){
        speechSynthesis.onvoiceschanged = loadVoices;
      }
    }

    function pickVoice(langPrefix){
      if(!voices.length) return null;
      const list = voices.filter(v => v.lang && v.lang.toLowerCase().startsWith(langPrefix.toLowerCase()));
      return list[0] || null;
    }

    const readerState = {
      vie:{index:0, reading:false},
      eng:{index:0, reading:false}
    };
    let currentLang = null;
    let currentUtterance = null;

    function clearHighlight(){
      sutraRows.forEach(r=>r.classList.remove('reading'));
    }

    function highlightRow(idx){
      clearHighlight();
      if(idx < 0 || idx >= sutraRows.length) return;
      const row = sutraRows[idx];
      row.classList.add('reading');

      const rowTop = row.offsetTop;
      const rowBottom = rowTop + row.offsetHeight;
      const viewTop = grid.scrollTop;
      const viewBottom = viewTop + grid.clientHeight;

      if(rowTop < viewTop || rowBottom > viewBottom){
        grid.scrollTo({top: rowTop - 20, behavior:'smooth'});
      }
    }

    function speakNext(lang){
      if(!synthSupported) return;
      const st = readerState[lang];
      if(!st.reading) return;

      if(st.index >= sutraRows.length){
        st.reading = false;
        currentLang = null;
        currentUtterance = null;
        clearHighlight();
        return;
      }

      const row = sutraRows[st.index];
      let text = '';
      if(lang === 'vie'){
        const el = row.querySelector('.vie');
        text = el ? el.innerText.trim() : '';
      }else if(lang === 'eng'){
        const el = row.querySelector('.eng');
        text = el ? el.innerText.trim() : '';
      }

      if(!text){
        st.index++;
        speakNext(lang);
        return;
      }

      highlightRow(st.index);

      const ut = new SpeechSynthesisUtterance(text);
      if(lang === 'vie'){
        ut.lang = 'vi-VN';
        const v = pickVoice('vi');
        if(v) ut.voice = v;
      }else{
        ut.lang = 'en-US';
        const v = pickVoice('en');
        if(v) ut.voice = v;
      }

      ut.onend = ()=>{
        if(st.reading){
          st.index++;
          speakNext(lang);
        }
      };
      ut.onerror = ()=>{
        st.reading = false;
        currentLang = null;
      };

      currentLang = lang;
      currentUtterance = ut;
      synth.speak(ut);
    }

    function startReading(lang){
      if(!synthSupported){
        alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªçc tho·∫°i.');
        return;
      }
      // d·ª´ng ng√¥n ng·ªØ kh√°c n·∫øu ƒëang ƒë·ªçc
      if(currentLang && currentLang !== lang){
        stopAllSpeech();
      }
      readerState[lang].reading = true;
      readerState[lang].index   = 0;
      speakNext(lang);
    }

    function stopAllSpeech(){
      if(synthSupported){
        synth.cancel();
      }
      readerState.vie.reading = false;
      readerState.eng.reading = false;
      currentLang = null;
      currentUtterance = null;
      clearHighlight();
    }

    btnReadVie.addEventListener('click', ()=>startReading('vie'));
    btnReadEng.addEventListener('click', ()=>startReading('eng'));
    btnStopTTS.addEventListener('click', stopAllSpeech);

    /* ========== SWIPE LEFT/RIGHT ƒê·ªîI B√ÄI ========== */
    let touchStartX = 0;
    let touchStartY = 0;
    let touchEndX   = 0;
    let touchEndY   = 0;
    const SWIPE_THRESHOLD = 60;

    grid.addEventListener('touchstart', e=>{
      if(e.touches.length > 0){
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      }
    }, {passive:true});

    grid.addEventListener('touchend', e=>{
      if(e.changedTouches.length > 0){
        touchEndX = e.changedTouches[0].clientX;
        touchEndY = e.changedTouches[0].clientY;
        handleSwipe();
      }
    });

    function handleSwipe(){
      const dx = touchEndX - touchStartX;
      const dy = touchEndY - touchStartY;
      if(Math.abs(dx) < Math.abs(dy)) return; // ∆∞u ti√™n vu·ªët ngang
      if(Math.abs(dx) < SWIPE_THRESHOLD) return;

      if(dx < 0){
        // vu·ªët tr√°i -> b√†i sau
        nextSutra();
      }else{
        // vu·ªët ph·∫£i -> b√†i tr∆∞·ªõc
        prevSutra();
      }
    }

    function nextSutra(){
      if(currentIndex < FLAT_SUTRAS.length - 1){
        renderSutraByIndex(currentIndex + 1);
      }
    }
    function prevSutra(){
      if(currentIndex > 0){
        renderSutraByIndex(currentIndex - 1);
      }
    }

    /* ========== INIT ========== */
    function init(){
      if(!window.SUTRA_TREE){
        titleEl.textContent = 'Kh√¥ng c√≥ d·ªØ li·ªáu SUTRA_TREE';
        return;
      }
      buildFlatList();
      buildAccordion();
      if(!FLAT_SUTRAS.length){
        titleEl.textContent = 'Ch∆∞a c√≥ b√†i kinh n√†o trong SUTRA_TREE';
        return;
      }
      // m·∫∑c ƒë·ªãnh b√†i ƒë·∫ßu ti√™n
      renderSutraByIndex(0);
      initSlider();
      applyVisibility();
    }

    init();
  })();
  </script>
</body>
</html>
