<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MN 131 ‚Äì Bhaddekaratta Sutta</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#64748b;
      --accent:#2563eb;
    }
    *{box-sizing:border-box}

    html,body{
      height:100%;
      margin:0;
      padding:0;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:#0f172a;
    }

    .page-wrapper{
      height:100%;
      display:flex;
      align-items:stretch;
      justify-content:center;
      padding:4px;
    }

    .sutra-card{
      background:var(--card);
      border-radius:5px;
      border:1px solid #e6edf7;
      padding:6px 10px 10px;
      max-width:none;
      width:100%;
      margin:0 auto;
      display:flex;
      flex-direction:column;
    }

    /* HEADER */
    .sutra-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding-top:6px;
      padding-bottom:4px;
    }

    .sutra-title{
      font-size:1rem;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.03em;
      color:var(--accent);
      margin:0;
      line-height:1.25;
    }

    #sutraSubtitle{
      font-size:12.5px;
      opacity:.78;
      margin-top:2px;
    }

    .controls{
      display:flex;
      align-items:center;
      gap:6px;
      background:#f1f5f9;
      padding:5px 6px;
      border-radius:10px;
      border:1px solid #e2e8f0;
    }

    .controls .btn{
      width:39px;
      height:32px;
      padding:0 .6rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:13px;
      border-radius:6px;
      white-space:nowrap;
      opacity:.9;
    }
    .controls .btn:hover{
      opacity:1;
    }

    .sutra-grid{
      flex:1 1 auto;
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow:auto;
      padding-top:4px;
    }

    .sutra-row{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
      padding:10px;
      border-radius:8px;
    }
    .sutra-row:nth-child(odd){
      background:rgba(37,99,235,0.03);
    }

    .sutra-col{
      min-height:1px;
      padding:6px;
      border-radius:6px;
    }

    .pali{font-family:"Noto Serif",serif;font-size:15px;line-height:1.6}
    .eng{font-family:Georgia,serif;font-size:14px;line-height:1.6}
    .vie{font-family:system-ui;font-size:14px;line-height:1.6}
    .col-head{font-weight:600;color:var(--muted);font-size:13px;margin-bottom:4px}

    .hide-pali .pali-col{display:none;}
    .hide-eng  .eng-col {display:none;}
    .hide-vie  .vie-col {display:none;}

    .stack .sutra-row{grid-template-columns:1fr;}

    /* Overlay cho Color */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }
    .overlay.show{display:flex;}
    .dialog{
      background:var(--card);
      border-radius:12px;
      padding:14px 18px;
      max-width:450px;
      width:90%;
      box-shadow:0 18px 45px rgba(15,23,42,0.35);
    }
    .dialog-close{
      border:none;
      background:transparent;
      font-size:20px;
      line-height:1;
      cursor:pointer;
      color:#64748b;
      padding-left:8px;
    }
    .dialog-close:hover{color:#0f172a;}

    .tab-btn.active{
      background-color:var(--accent);
      color:#fff !important;
    }

    .dialog .btn{
      min-width:110px;
      text-align:center;
    }

    /* SVG icon Row / Col */
    .layout-icon{
      width:18px;
      height:18px;
      stroke:#475569;
      stroke-width:2;
      stroke-linecap:round;
      fill:none;
      transition:transform .15s ease;
    }
    /* Col = xoay 90 ƒë·ªô */
    .layout-icon.vertical{
      transform:rotate(90deg);
    }

    /* Responsive header cho tablet/mobile */
    @media (max-width: 1024px){
      .sutra-header{
        flex-direction:column-reverse;
        align-items:flex-start;
        gap:6px;
      }
      .controls{
        width:100%;
        justify-content:flex-start;
        flex-wrap:wrap;
      }
    }

    @media(max-width:768px){
      .sutra-row{grid-template-columns:1fr;}
      .controls .btn{min-width:72px;}
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="sutra-card">
      <!-- HEADER TRONG TRANG KINH -->
      <div class="sutra-header">
        <div>
          <h1 id="sutraTitleLocal" class="sutra-title">
            MN 131 ‚Äì BHADDEKARATTA SUTTA
          </h1>
          <div id="sutraSubtitle" class="text-muted small">
            <!-- s·∫Ω ƒë∆∞·ª£c JS set l·∫°i -->
            Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£
          </div>
        </div>

        <div class="controls" aria-label="Languages and view">
          <div class="btn-group btn-group-sm" role="group" aria-label="Languages">
            <button type="button" class="btn btn-outline-secondary active" id="btnPali">PLI</button>
            <button type="button" class="btn btn-outline-secondary active" id="btnEng">EN</button>
            <button type="button" class="btn btn-outline-secondary active" id="btnVie">VI</button>
          </div>
          <button id="btnLayout" class="btn btn-outline-secondary btn-sm" type="button" title="ƒê·ªïi ki·ªÉu hi·ªÉn th·ªã">
            <svg id="layoutIcon" class="layout-icon" viewBox="0 0 24 24" aria-hidden="true">
              <line x1="4" y1="6"  x2="20" y2="6"  />
              <line x1="4" y1="12" x2="20" y2="12" />
              <line x1="4" y1="18" x2="20" y2="18" />
            </svg>
          </button>
          <button id="btnColor" class="btn btn-outline-secondary btn-sm" type="button" title="M√†u s·∫Øc c·ªôt">
            üé®
          </button>
        </div>
      </div>

      <!-- N·ªòI DUNG KINH -->
      <div id="sutraGrid" class="sutra-grid">
        <!-- Row 1 -->
        <div class="sutra-row" data-idx="1">
          <div class="sutra-col pali-col">
            <div class="col-head">PƒÅli</div>
            <div class="pali">
              Eva·πÅ me suta·πÅ: Eka·πÅ samaya·πÅ bhagavƒÅ sƒÅvatthiya·πÅ vihƒÅrati jetavane anƒÅthapi·πá·∏çikassa ƒÅrƒÅme.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="col-head">English</div>
            <div class="eng">
              Thus have I heard: At one time the Blessed One was dwelling at SƒÅvatthƒ´, in Jeta's Grove, AnƒÅthapi·πá·∏çika's Park.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="col-head">Ti·∫øng Vi·ªát</div>
            <div class="vie">
              Nghe nh∆∞ v·∫ßy: C√≥ m·ªôt th·ªùi, Th·∫ø T√¥n tr√∫ t·∫°i X√°-v·ªá, trong r·ª´ng K·ª≥-ƒë√†, t·∫°i khu v∆∞·ªùn c·ªßa AnƒÅthapi·πá·∏çika.
            </div>
          </div>
        </div>

        <!-- Row 2 -->
        <div class="sutra-row" data-idx="2">
          <div class="sutra-col pali-col">
            <div class="pali">
              Tatra kho bhagavƒÅ bhikkh≈´ ƒÅmantesi: ‚ÄúBhikkhavo‚Äùti. ‚ÄúBhaddante‚Äùti te bhikkh≈´ bhagavato paccassosu·πÅ.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="eng">
              There the Blessed One addressed the bhikkhus: ‚ÄúBhikkhus!‚Äù ‚ÄúVenerable sir,‚Äù the bhikkhus replied to the Blessed One.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="vie">
              ·ªû ƒë√≥ Th·∫ø T√¥n n√≥i v·ªõi c√°c t·ª≥-kheo: ‚ÄúN√†y c√°c t·ª≥-kheo.‚Äù ‚ÄúB·∫°ch tr∆∞·ªüng l√£o,‚Äù c√°c t·ª≥-kheo tr·∫£ l·ªùi ƒê·ª©c Ph·∫≠t.
            </div>
          </div>
        </div>

        <!-- Row 3 -->
        <div class="sutra-row" data-idx="3">
          <div class="sutra-col pali-col">
            <div class="pali">
              Atƒ´ta·πÅ nƒÅnvƒÅgameyya, nappa·π≠ika·πÖkhe anƒÅgata·πÅ; yadatƒ´ta·πÅ pahƒ´na·πÅ ta·πÅ, appatta√±ca anƒÅgata·πÅ.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="eng">
              Let the past not be clung to; the future not expected; whatever is past has been left behind, and the future is not yet come.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="vie">
              ƒê·ª´ng b√°m v√≠u v√†o qu√° kh·ª©, ƒë·ª´ng mong ch·ªù t∆∞∆°ng lai; ƒëi·ªÅu ƒë√£ qua ƒë√£ b·ªè, ƒëi·ªÅu t∆∞∆°ng lai ch∆∞a ƒë·∫øn.
            </div>
          </div>
        </div>

        <!-- Row 4 -->
        <div class="sutra-row" data-idx="4">
          <div class="sutra-col pali-col">
            <div class="pali">
              Idamavoca bhagavƒÅ. AttamanƒÅ te bhikkh≈´ bhagavato bhƒÅsita·πÅ abhinandunti. Bhaddekarattasutta·πÅ ni·π≠·π≠hita·πÅ.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="eng">
              Thus the Blessed One spoke. The bhikkhus were glad and praised what had been said by the Blessed One. The Bhaddekaratta Sutta is concluded.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="vie">
              ƒê·ª©c Ph·∫≠t thuy·∫øt xong. C√°c t·ª≥-kheo hoan h·ª∑ v√† t√°n th√°n l·ªùi Ph·∫≠t d·∫°y. Kinh Bhaddekaratta k·∫øt th√∫c.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- COLOR OVERLAY -->
  <div id="colorOverlay" class="overlay" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 id="colorTitle" class="mb-0">üé® </h2>
        <div class="d-flex align-items-center gap-2">
          <div class="btn-group btn-group-sm" role="tablist">
            <button type="button" class="btn btn-outline-secondary tab-btn active" id="tabPali">
              PƒÅli
            </button>
            <button type="button" class="btn btn-outline-secondary tab-btn" id="tabEng">
              English
            </button>
            <button type="button" class="btn btn-outline-secondary tab-btn" id="tabVie">
              Vietnamese
            </button>
          </div>
          <button type="button" class="dialog-close" id="colorClose">√ó</button>
        </div>
      </div>

      <!-- PƒÅli -->
      <div id="colorContentPali">
        <p class="mb-2">Ch·ªânh m√†u cho c·ªôt PƒÅli.</p>
        <p class="mb-2">Color settings for the Pali column.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u ch·ªØ / Text color :</span>
          <input id="paliColor" type="color" title="M√†u ch·ªØ PƒÅli" value="#0f172a">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u n·ªÅn / Background:</span>
          <input id="paliBg" type="color" title="M√†u n·ªÅn PƒÅli" value="#ffffff">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetPali">Reset / ƒê·∫∑t l·∫°i</button>
        </div>
      </div>

      <!-- English -->
      <div id="colorContentEng" class="d-none">
        <p class="mb-2">Ch·ªânh m√†u cho c·ªôt English.</p>
        <p class="mb-2">Color settings for the English column.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u ch·ªØ / Text color :</span>
          <input id="engColor" type="color" title="English text color" value="#0f172a">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u n·ªÅn / Background:</span>
          <input id="engBg" type="color" title="English background color" value="#ffffff">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetEng">Reset / ƒê·∫∑t l·∫°i</button>
        </div>
      </div>

      <!-- Vietnamese -->
      <div id="colorContentVie" class="d-none">
        <p class="mb-2">Ch·ªânh m√†u cho c·ªôt Ti·∫øng Vi·ªát.</p>
        <p class="mb-2">Color settings for the Vietnamese column.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u ch·ªØ / Text color :</span>
          <input id="vieColor" type="color" title="M√†u ch·ªØ Ti·∫øng Vi·ªát" value="#0f172a">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u n·ªÅn / Background:</span>
          <input id="vieBg" type="color" title="M√†u n·ªÅn Ti·∫øng Vi·ªát" value="#ffffff">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetVie">Reset / ƒê·∫∑t l·∫°i</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      'use strict';

      const grid        = document.getElementById('sutraGrid');
      const card        = document.querySelector('.sutra-card');
      const btnPali     = document.getElementById('btnPali');
      const btnEng      = document.getElementById('btnEng');
      const btnVie      = document.getElementById('btnVie');
      const btnLayout   = document.getElementById('btnLayout');
      const btnColor    = document.getElementById('btnColor');
      const layoutIcon  = document.getElementById('layoutIcon');

      const paliCols    = document.querySelectorAll('.pali-col');
      const engCols     = document.querySelectorAll('.eng-col');
      const vieCols     = document.querySelectorAll('.vie-col');

      const colorOverlay    = document.getElementById('colorOverlay');
      const colorClose      = document.getElementById('colorClose');
      const tabPali         = document.getElementById('tabPali');
      const tabEng          = document.getElementById('tabEng');
      const tabVie          = document.getElementById('tabVie');
      const colorContentPali = document.getElementById('colorContentPali');
      const colorContentEng  = document.getElementById('colorContentEng');
      const colorContentVie  = document.getElementById('colorContentVie');

      const paliBgInput     = document.getElementById('paliBg');
      const paliColorInput  = document.getElementById('paliColor');
      const engBgInput      = document.getElementById('engBg');
      const engColorInput   = document.getElementById('engColor');
      const vieBgInput      = document.getElementById('vieBg');
      const vieColorInput   = document.getElementById('vieColor');

      const resetPaliBtn    = document.getElementById('resetPali');
      const resetEngBtn     = document.getElementById('resetEng');
      const resetVieBtn     = document.getElementById('resetVie');

      const subTitle        = document.getElementById('sutraSubtitle');

      let showPali = true;
      let showEng  = true;
      let showVie  = true;

      const defaultColors = {
        paliBg: '#ffffff',
        paliColor: '#0f172a',
        engBg: '#ffffff',
        engColor: '#0f172a',
        vieBg: '#ffffff',
        vieColor: '#0f172a'
      };

      /* ==== Subtitle theo ng√¥n ng·ªØ ƒëang hi·ªÉn th·ªã ==== */
      function updateSubtitleByLang(){
        if(showEng && showVie){
          subTitle.innerHTML =
            'The Discourse on a Single Excellent Night<br>' +
            'Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£';
        }else if(showEng){
          subTitle.textContent = 'The Discourse on a Single Excellent Night';
        }else if(showVie){
          subTitle.textContent = 'Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£';
        }else{
          subTitle.textContent = '';
        }
      }

      /* ==== Layout & visibility ==== */
      function adjustRowColumns(){
        const rows = grid.querySelectorAll('.sutra-row');
        rows.forEach(row=>{
          if(card.classList.contains('stack')){
            row.style.gridTemplateColumns = '1fr';
            return;
          }
          const cols = Array.from(row.querySelectorAll('.sutra-col'));
          const visible = cols.filter(col=>{
            if(col.classList.contains('pali-col') && !showPali) return false;
            if(col.classList.contains('eng-col')  && !showEng)  return false;
            if(col.classList.contains('vie-col')  && !showVie)  return false;
            return true;
          });
          const n = Math.max(1, visible.length);
          row.style.gridTemplateColumns = `repeat(${n},1fr)`;
        });
      }

      function updateVisibility(){
        grid.classList.toggle('hide-pali', !showPali);
        grid.classList.toggle('hide-eng',  !showEng);
        grid.classList.toggle('hide-vie',  !showVie);
        adjustRowColumns();
      }

      btnPali.addEventListener('click',()=>{
        showPali = !showPali;
        btnPali.classList.toggle('active', showPali);
        updateVisibility();
        updateSubtitleByLang();
      });

      btnEng.addEventListener('click',()=>{
        showEng = !showEng;
        btnEng.classList.toggle('active', showEng);
        updateVisibility();
        updateSubtitleByLang();
      });

      btnVie.addEventListener('click',()=>{
        showVie = !showVie;
        btnVie.classList.toggle('active', showVie);
        updateVisibility();
        updateSubtitleByLang();
      });

      btnLayout.addEventListener('click',()=>{
        card.classList.toggle('stack');
        const isStack = card.classList.contains('stack');
        layoutIcon.classList.toggle('vertical', isStack);
        adjustRowColumns();
      });

      /* ==== Overlay Color ==== */
      function setColorTab(lang){
        const isPali = lang === 'pali';
        const isEng  = lang === 'eng';
        const isVie  = lang === 'vie';

        tabPali.classList.toggle('active', isPali);
        tabEng.classList.toggle('active',  isEng);
        tabVie.classList.toggle('active',  isVie);

        colorContentPali.classList.toggle('d-none', !isPali);
        colorContentEng.classList.toggle('d-none',  !isEng);
        colorContentVie.classList.toggle('d-none',  !isVie);
      }

      function openColor(){
        colorOverlay.classList.add('show');
        colorOverlay.setAttribute('aria-hidden','false');
      }
      function closeColor(){
        colorOverlay.classList.remove('show');
        colorOverlay.setAttribute('aria-hidden','true');
      }

      btnColor.addEventListener('click',(e)=>{
        e.stopPropagation();
        openColor();
      });
      colorClose.addEventListener('click',(e)=>{
        e.stopPropagation();
        closeColor();
      });
      colorOverlay.addEventListener('click',(e)=>{
        if(e.target===colorOverlay) closeColor();
      });

      tabPali.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('pali'); });
      tabEng.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('eng'); });
      tabVie.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('vie'); });

      /* ==== Load / Save m√†u (bh_colors) ==== */
      function loadColors(){
        let saved = {};
        try{
          saved = JSON.parse(localStorage.getItem('bh_colors') || '{}');
        }catch(e){
          saved = {};
        }

        const colors = {
          paliBg:   saved.paliBg   || defaultColors.paliBg,
          paliColor:saved.paliColor|| defaultColors.paliColor,
          engBg:    saved.engBg    || defaultColors.engBg,
          engColor: saved.engColor || defaultColors.engColor,
          vieBg:    saved.vieBg    || defaultColors.vieBg,
          vieColor: saved.vieColor || defaultColors.vieColor
        };

        paliBgInput.value    = colors.paliBg;
        paliColorInput.value = colors.paliColor;
        engBgInput.value     = colors.engBg;
        engColorInput.value  = colors.engColor;
        vieBgInput.value     = colors.vieBg;
        vieColorInput.value  = colors.vieColor;

        paliCols.forEach(c=>{
          c.style.background = colors.paliBg;
          c.style.color      = colors.paliColor;
        });
        engCols.forEach(c=>{
          c.style.background = colors.engBg;
          c.style.color      = colors.engColor;
        });
        vieCols.forEach(c=>{
          c.style.background = colors.vieBg;
          c.style.color      = colors.vieColor;
        });
      }

      function saveColors(){
        const obj = {
          paliBg:   paliBgInput.value   || defaultColors.paliBg,
          paliColor:paliColorInput.value|| defaultColors.paliColor,
          engBg:    engBgInput.value    || defaultColors.engBg,
          engColor: engColorInput.value || defaultColors.engColor,
          vieBg:    vieBgInput.value    || defaultColors.vieBg,
          vieColor: vieColorInput.value || defaultColors.vieColor
        };
        try{
          localStorage.setItem('bh_colors', JSON.stringify(obj));
        }catch(e){}
      }

      function setupColorControls(cols, bgInput, colorInput, resetBtn, defaults){
        bgInput.addEventListener('input', e=>{
          const value = e.target.value;
          cols.forEach(c=>{ c.style.background = value; });
          saveColors();
        });

        colorInput.addEventListener('input', e=>{
          const value = e.target.value;
          cols.forEach(c=>{ c.style.color = value; });
          saveColors();
        });

        resetBtn.addEventListener('click',()=>{
          cols.forEach(c=>{
            c.style.background = defaults.bg;
            c.style.color      = defaults.color;
          });
          bgInput.value    = defaults.bg;
          colorInput.value = defaults.color;
          saveColors();
        });
      }

      setupColorControls(
        paliCols,
        paliBgInput,
        paliColorInput,
        resetPaliBtn,
        {bg: defaultColors.paliBg, color: defaultColors.paliColor}
      );
      setupColorControls(
        engCols,
        engBgInput,
        engColorInput,
        resetEngBtn,
        {bg: defaultColors.engBg, color: defaultColors.engColor}
      );
      setupColorControls(
        vieCols,
        vieBgInput,
        vieColorInput,
        resetVieBtn,
        {bg: defaultColors.vieBg, color: defaultColors.vieColor}
      );

      // init
      setColorTab('pali');
      loadColors();
      updateVisibility();
      updateSubtitleByLang();
      layoutIcon.classList.remove('vertical');
    })();
  </script>
</body>
</html>
