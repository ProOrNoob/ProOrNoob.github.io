
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MN 131 ‚Äì Bhaddekaratta Sutta</title>
 <link href="https://dhammaarchive.info/css/bs.css" rel="stylesheet">
 

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --muted:#64748b;
  --accent:#2563eb;
  --border:#e2e8f0;
}

*{box-sizing:border-box;}

html,body{
  height:100%;
  margin:0;
  padding:0;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:#0f172a;
}

.page-wrapper{
  height:100%;
  display:flex;
  justify-content:center;
  align-items:stretch;
  padding:4px;
}

.sutra-card{
  background:var(--card);
  border-radius:18px;
  border:1px solid rgba(148,163,184,0.35);
  padding:12px 14px 16px;
  width:100%;
  max-width:100%;
  display:flex;
  flex-direction:column;
  position:relative;
  box-shadow:0 12px 30px rgba(15,23,42,0.12);
}

/* ============= HEADER ============= */
.sutra-header{
  display:flex;
  flex-direction:row;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
  padding:6px 0;
  border-bottom:1px solid rgba(148,163,184,0.25);
}

.sutra-header > div:first-child{
  flex:1 1 auto;
  min-width:0;
}

.sutra-title{
  font-size:1.05rem;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:.08em;
  color:var(--accent);
  margin:0;
  line-height:1.3;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

#sutraSubtitle{
  font-size:12.5px;
  margin-top:3px;
  color:var(--muted);
  line-height:1.35;
}

/* ============= HEADER ACTIONS ============= */
.header-actions{
  position:relative;                /* ƒë·ªÉ menu c√≥ ch·ªó b√°m */
  display:flex;
  flex-direction:row;
  align-items:flex-start;
  gap:8px;
  margin-top:2px;
}

/* ======= N√öT CHUNG (‚öô + controls) ======= */
.settings-btn,
.sutra-card .controls .btn,
.sutra-card .controls .btn-group > .btn{
  width:56px;
  min-width:56px;
  height:38px;
  padding:0;
  border-radius:12px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  line-height:1;
  border-width:1px;
  border-color:rgba(148,163,184,0.9);
  cursor:pointer;
  white-space:nowrap;
}

.sutra-card .controls .btn-group > .btn{
  margin:0;
}

/* ============= CONTROLS (toolbar) ============= */
/* Desktop / tablet: n·∫±m ngang */
.controls{
  display:none;
  align-items:center;
  flex-wrap:nowrap;
  gap:8px;
  margin-right:4px;
}
.controls.open{display:flex;}

.controls-left,
.controls-right{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:nowrap;
}

.controls .btn-group{
  display:flex;
  gap:8px;
}

#btnPali,#btnEng,#btnVie{
  font-weight:600;
  letter-spacing:.03em;
}

#btnLayout,
#btnColor,
#btnReadVie,
#btnPauseVie,
#btnRestartVie,
#btnStopVie,
#btnReadEng,
#btnPauseEng,
#btnRestartEng,
#btnStopEng{
  padding:0;
}

/* icon layout */
.layout-icon{
  width:16px;
  height:16px;
  stroke:#475569;
  stroke-width:2;
  stroke-linecap:round;
  fill:none;
  transition:transform .15s ease;
}
.layout-icon.vertical{transform:rotate(90deg);}

/* ============= GRID N·ªòI DUNG ============= */
.sutra-grid{
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  gap:8px;
  overflow:auto;
  padding:10px 6px 32px;
}

.sutra-row{
  position:relative;
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:8px;
  padding:8px 10px;
  margin:2px 0;
  border-radius:14px;
  border:1px solid rgba(148,163,184,0.25);
  background:#ffffff;
}

.stack .sutra-row{grid-template-columns:1fr;}

.sutra-col{
  min-height:1px;
  padding:2px 4px;
  border-radius:10px;
}

.pali{font-family:"Noto Serif",serif;font-size:14.5px;line-height:1.75;}
.eng{font-family:Georgia,serif;font-size:13.5px;line-height:1.75;}
.vie{font-family:system-ui;font-size:13.5px;line-height:1.75;}

.col-head{
  font-weight:600;
  color:var(--muted);
  font-size:11.5px;
  margin-bottom:3px;
  text-transform:uppercase;
  letter-spacing:.05em;
}

.hide-pali .pali-col{display:none;}
.hide-eng  .eng-col {display:none;}
.hide-vie  .vie-col {display:none;}

/* highlight */
.sutra-row.reading{
  background:#ffffff !important;
  border:2px solid rgba(37,99,235,0.95);
  box-shadow:0 0 0 3px rgba(191,219,254,0.9);
  z-index:1;
}

/* ============= OVERLAY COLOR ============= */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,0.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
  padding:16px;
}
.overlay.show{display:flex;}

.dialog{
  background:#fff;
  border-radius:16px;
  padding:14px 16px;
  max-width:450px;
  width:96%;
  box-shadow:0 20px 50px rgba(15,23,42,0.45);
  border:1px solid rgba(148,163,184,0.45);
}

.dialog-close{
  border:none;
  background:transparent;
  font-size:22px;
  line-height:1;
  cursor:pointer;
  color:#64748b;
  padding-left:8px;
}
.dialog-close:hover{color:#0f172a;}

.tab-btn.active{
  background-color:var(--accent);
  color:#fff !important;
  border-color:var(--accent);
}

/* ============= BACK TO TOP ============= */
#backToTop{
  position:absolute;
  right:14px;
  bottom:12px;
  width:32px;
  height:32px;
  border-radius:10px;
  border:1px solid rgba(148,163,184,0.8);
  background:#f8fafc;
  color:#2563eb;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(15,23,42,0.3);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
}
#backToTop.show{
  opacity:1;
  pointer-events:auto;
}

/* ============= RESPONSIVE ============= */
@media (max-width:1024px){
  .sutra-card{margin:4px 6px;}
}

/* MOBILE: <= 576px ‚Äì menu x·ªï d·ªçc, N·ªîI, kh√¥ng ƒë·∫©y n·ªôi dung */
@media (max-width:768px){

  .sutra-card{
    padding:10px 10px 14px;
  }

  .sutra-header{
    align-items:flex-start;
    gap:8px;
  }

.header-actions{
    position: relative;
    flex-direction: column;
    align-items: flex-end;
    margin-right: 8px;
    gap: 8px;
  }

  /* MENU N·ªîI: b√°m d∆∞·ªõi header-actions, kh√¥ng ƒë·∫©y n·ªôi dung */
  .controls{
     position: absolute;
    top: 100%;
    right: -1px;              /* b√°m m√©p ph·∫£i c·ªßa header-actions */
    left: auto;            /* CH·∫ÆC CH·∫ÆN kh√¥ng c√≤n left:100% */
    transform: none;       /* h·ªßy m·ªçi transform c≈© */
    margin-top: 6px;

    background: transparent;
    box-shadow: none;
    padding: 0;

    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;

    z-index: 2000;
  }
 .settings-btn{
    align-self: flex-end;
  }
   .controls-left,
  .controls-right,
  .controls .btn-group{
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
  }

  .sutra-row{
    grid-template-columns:1fr;
  }
}

@media (max-width:480px){
  .sutra-title{
    font-size:.96rem;
    letter-spacing:.07em;
  }
}
</style>


</head>
<body>
  <div class="page-wrapper">
    <div class="sutra-card">
      <!-- HEADER TRONG TRANG KINH -->
      <div class="sutra-header">
        <div>
          <h1 id="sutraTitleLocal" class="sutra-title">
            MN 131 ‚Äì BHADDEKARATTA SUTTA
          </h1>
          <div id="sutraSubtitle" class="text-muted small">
            Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£
          </div>
        </div>

        <!-- KH·ªêI ACTION B√äN PH·∫¢I: TOOLBAR + N√öT SETTINGS -->
        <!-- L∆ØU √ù: controls ƒë·∫∑t TR∆Ø·ªöC, settings ƒë·∫∑t SAU ƒë·ªÉ khi m·ªü n√≥ d√†n ra b√™n tr√°i n√∫t ‚öô -->
        <div class="header-actions">
          <!-- TOOLBAR (·∫©n/hi·ªán khi b·∫•m settings) -->
          <div id="sutraControls" class="controls" aria-label="Languages and view">
            <!-- B√äN TR√ÅI -->
            <div class="controls-left">
              <div class="btn-group btn-group-sm" role="group" aria-label="Languages">
                <button type="button" class="btn btn-outline-secondary active" id="btnPali">PLI</button>
                <button type="button" class="btn btn-outline-secondary active" id="btnEng">EN</button>
                <button type="button" class="btn btn-outline-secondary active" id="btnVie">VI</button>
              </div>

              <button id="btnLayout" class="btn btn-outline-secondary btn-sm" type="button" title="ƒê·ªïi ki·ªÉu hi·ªÉn th·ªã">
                <svg id="layoutIcon" class="layout-icon" viewBox="0 0 24 24" aria-hidden="true">
                  <line x1="4" y1="6"  x2="20" y2="6"  />
                  <line x1="4" y1="12" x2="20" y2="12" />
                  <line x1="4" y1="18" x2="20" y2="18" />
                </svg>
              </button>

              <button id="btnColor" class="btn btn-outline-secondary btn-sm" type="button" title="M√†u s·∫Øc c·ªôt">
                üé®
              </button>
            </div>

            <!-- B√äN PH·∫¢I: voice controls (·∫©n hi·ªán t√πy browser) -->
            <div class="controls-right" id="voiceControls">
              <!-- Nh√≥m n√∫t ƒë·ªçc Ti·∫øng Vi·ªát -->
              <div class="btn-group btn-group-sm" role="group" aria-label="Read Vietnamese">
                <button type="button" class="btn btn-outline-secondary" id="btnReadVie">üîä VI</button>
                <button type="button" class="btn btn-outline-secondary d-none" id="btnPauseVie">‚è∏</button>
                <button type="button" class="btn btn-outline-secondary d-none" id="btnRestartVie">‚èÆ</button>
                <button type="button" class="btn btn-outline-secondary d-none" id="btnStopVie">‚èπ</button>
              </div>

              <!-- Nh√≥m n√∫t ƒë·ªçc English -->
              <div class="btn-group btn-group-sm" role="group" aria-label="Read English">
                <button type="button" class="btn btn-outline-secondary" id="btnReadEng">üîä EN</button>
                <button type="button" class="btn btn-outline-secondary d-none" id="btnPauseEng">‚è∏</button>
                <button type="button" class="btn btn-outline-secondary d-none" id="btnRestartEng">‚èÆ</button>
                <button type="button" class="btn btn-outline-secondary d-none" id="btnStopEng">‚èπ</button>
              </div>
            </div>
          </div>

          <!-- N√∫t SETTINGS -->
          <button id="btnSettings"
                  class="btn btn-outline-secondary btn-sm settings-btn"
                  type="button"
                  aria-expanded="false"
                  aria-controls="sutraControls"
                  title="C√†i ƒë·∫∑t hi·ªÉn th·ªã">
            ‚öô
          </button>
        </div>
      </div>

      <!-- N·ªòI DUNG KINH -->
      <div id="sutraGrid" class="sutra-grid">
        <!-- Row 1 -->
        <div class="sutra-row" data-idx="1">
          <div class="sutra-col pali-col">
            <div class="col-head">PƒÅli</div>
            <div class="pali">
              Eva·πÅ me suta·πÅ: Eka·πÅ samaya·πÅ bhagavƒÅ sƒÅvatthiya·πÅ vihƒÅrati jetavane anƒÅthapi·πá·∏çikassa ƒÅrƒÅme.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="col-head">English</div>
            <div class="eng">
              Thus have I heard: At one time the Blessed One was dwelling at SƒÅvatthƒ´, in Jeta's Grove, AnƒÅthapi·πá·∏çika's Park.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="col-head">Ti·∫øng Vi·ªát</div>
            <div class="vie">
              Nghe nh∆∞ v·∫ßy: C√≥ m·ªôt th·ªùi, Th·∫ø T√¥n tr√∫ t·∫°i X√°-v·ªá, trong r·ª´ng K·ª≥-ƒë√†, t·∫°i khu v∆∞·ªùn c·ªßa AnƒÅthapi·πá·∏çika.
            </div>
          </div>
        </div>

        <!-- Row 2 -->
        <div class="sutra-row" data-idx="2">
          <div class="sutra-col pali-col">
            <div class="pali">
              Tatra kho bhagavƒÅ bhikkh≈´ ƒÅmantesi: ‚ÄúBhikkhavo‚Äùti. ‚ÄúBhaddante‚Äùti te bhikkh≈´ bhagavato paccassosu·πÅ.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="eng">
              There the Blessed One addressed the bhikkhus: ‚ÄúBhikkhus!‚Äù ‚ÄúVenerable sir,‚Äù the bhikkhus replied to the Blessed One.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="vie">
              ·ªû ƒë√≥ Th·∫ø T√¥n n√≥i v·ªõi c√°c t·ª≥-kheo: ‚ÄúN√†y c√°c t·ª≥-kheo.‚Äù ‚ÄúB·∫°ch tr∆∞·ªüng l√£o,‚Äù c√°c t·ª≥-kheo tr·∫£ l·ªùi ƒê·ª©c Ph·∫≠t.
            </div>
          </div>
        </div>

        <!-- Row 3 -->
        <div class="sutra-row" data-idx="3">
          <div class="sutra-col pali-col">
            <div class="pali">
              Atƒ´ta·πÅ nƒÅnvƒÅgameyya, nappa·π≠ika·πÖkhe anƒÅgata·πÅ; yadatƒ´ta·πÅ pahƒ´na·πÅ ta·πÅ, appatta√±ca anƒÅgata·πÅ.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="eng">
              Let the past not be clung to; the future not expected; whatever is past has been left behind, and the future is not yet come.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="vie">
              ƒê·ª´ng b√°m v√≠u v√†o qu√° kh·ª©, ƒë·ª´ng mong ch·ªù t∆∞∆°ng lai; ƒëi·ªÅu ƒë√£ qua ƒë√£ b·ªè, ƒëi·ªÅu t∆∞∆°ng lai ch∆∞a ƒë·∫øn.
            </div>
          </div>
        </div>

        <div class="sutra-row" data-idx="4">
          <div class="sutra-col pali-col">
            <div class="pali">
              Atƒ´ta·πÅ nƒÅnvƒÅgameyya, nappa·π≠ika·πÖkhe anƒÅgata·πÅ; yadatƒ´ta·πÅ pahƒ´na·πÅ ta·πÅ, appatta√±ca anƒÅgata·πÅ.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="eng">
              Let the past not be clung to; the future not expected; whatever is past has been left behind, and the future is not yet come.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="vie">
              ƒê·ª´ng b√°m v√≠u v√†o qu√° kh·ª©, ƒë·ª´ng mong ch·ªù t∆∞∆°ng lai; ƒëi·ªÅu ƒë√£ qua ƒë√£ b·ªè, ƒëi·ªÅu t∆∞∆°ng lai ch∆∞a ƒë·∫øn.
            </div>
          </div>
        </div>

        <div class="sutra-row" data-idx="5">
          <div class="sutra-col pali-col">
            <div class="pali">
              Atƒ´ta·πÅ nƒÅnvƒÅgameyya, nappa·π≠ika·πÖkhe anƒÅgata·πÅ; yadatƒ´ta·πÅ pahƒ´na·πÅ ta·πÅ, appatta√±ca anƒÅgata·πÅ.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="eng">
              Let the past not be clung to; the future not expected; whatever is past has been left behind, and the future is not yet come.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="vie">
              ƒê·ª´ng b√°m v√≠u v√†o qu√° kh·ª©, ƒë·ª´ng mong ch·ªù t∆∞∆°ng lai; ƒëi·ªÅu ƒë√£ qua ƒë√£ b·ªè, ƒëi·ªÅu t∆∞∆°ng lai ch∆∞a ƒë·∫øn.
            </div>
          </div>
        </div>

        <!-- Row 6 -->
        <div class="sutra-row" data-idx="6">
          <div class="sutra-col pali-col">
            <div class="pali">
              Idamavoca bhagavƒÅ. AttamanƒÅ te bhikkh≈´ bhagavato bhƒÅsita·πÅ abhinandunti. Bhaddekarattasutta·πÅ ni·π≠·π≠hita·πÅ.
            </div>
          </div>
          <div class="sutra-col eng-col">
            <div class="eng">
              Thus the Blessed One spoke. The bhikkhus were glad and praised what had been said by the Blessed One. The Bhaddekaratta Sutta is concluded.
            </div>
          </div>
          <div class="sutra-col vie-col">
            <div class="vie">
              ƒê·ª©c Ph·∫≠t thuy·∫øt xong. C√°c t·ª≥-kheo hoan h·ª∑ v√† t√°n th√°n l·ªùi Ph·∫≠t d·∫°y. Kinh Bhaddekaratta k·∫øt th√∫c.
            </div>
          </div>
        </div>
      </div>

      <!-- BACK TO TOP BUTTON -->
      <button id="backToTop" title="L√™n ƒë·∫ßu trang" aria-label="L√™n ƒë·∫ßu trang" aria-hidden="true">
        ‚Üë
      </button>
    </div>
  </div>

  <!-- COLOR OVERLAY -->
  <div id="colorOverlay" class="overlay" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="colorTitle">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 id="colorTitle" class="mb-0">üé® </h2>
        <div class="d-flex align-items-center gap-2">
          <div class="btn-group btn-group-sm" role="tablist">
            <button type="button" class="btn btn-outline-secondary tab-btn active" id="tabPali">
              PƒÅli
            </button>
            <button type="button" class="btn btn-outline-secondary tab-btn" id="tabEng">
              English
            </button>
            <button type="button" class="btn btn-outline-secondary tab-btn" id="tabVie">
              Vietnamese
            </button>
          </div>
          <button type="button" class="dialog-close" id="colorClose">√ó</button>
        </div>
      </div>

      <!-- PƒÅli -->
      <div id="colorContentPali">
        <p class="mb-2">Ch·ªânh m√†u cho c·ªôt PƒÅli.</p>
        <p class="mb-2">Color settings for the Pali column.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u ch·ªØ / Text color :</span>
          <input id="paliColor" type="color" title="M√†u ch·ªØ PƒÅli" value="#0f172a">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u n·ªÅn / Background:</span>
          <input id="paliBg" type="color" title="M√†u n·ªÅn PƒÅli" value="#ffffff">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetPali">Reset / ƒê·∫∑t l·∫°i</button>
        </div>
      </div>

      <!-- English -->
      <div id="colorContentEng" class="d-none">
        <p class="mb-2">Ch·ªânh m√†u cho c·ªôt English.</p>
        <p class="mb-2">Color settings for the English column.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u ch·ªØ / Text color :</span>
          <input id="engColor" type="color" title="English text color" value="#0f172a">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u n·ªÅn / Background:</span>
          <input id="engBg" type="color" title="English background color" value="#ffffff">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetEng">Reset / ƒê·∫∑t l·∫°i</button>
        </div>
      </div>

      <!-- Vietnamese -->
      <div id="colorContentVie" class="d-none">
        <p class="mb-2">Ch·ªânh m√†u cho c·ªôt Ti·∫øng Vi·ªát.</p>
        <p class="mb-2">Color settings for the Vietnamese column.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u ch·ªØ / Text color :</span>
          <input id="vieColor" type="color" title="M√†u ch·ªØ Ti·∫øng Vi·ªát" value="#0f172a">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>M√†u n·ªÅn / Background:</span>
          <input id="vieBg" type="color" title="M√†u n·ªÅn Ti·∫øng Vi·ªát" value="#ffffff">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetVie">Reset / ƒê·∫∑t l·∫°i</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      'use strict';

      const grid        = document.getElementById('sutraGrid');
      const card        = document.querySelector('.sutra-card');

      const btnSettings   = document.getElementById('btnSettings');
      const sutraControls = document.getElementById('sutraControls');

      const btnPali     = document.getElementById('btnPali');
      const btnEng      = document.getElementById('btnEng');
      const btnVie      = document.getElementById('btnVie');
      const btnLayout   = document.getElementById('btnLayout');
      const btnColor    = document.getElementById('btnColor');
      const layoutIcon  = document.getElementById('layoutIcon');

      const paliCols    = document.querySelectorAll('.pali-col');
      const engCols     = document.querySelectorAll('.eng-col');
      const vieCols     = document.querySelectorAll('.vie-col');

      const colorOverlay    = document.getElementById('colorOverlay');
      const colorClose      = document.getElementById('colorClose');
      const tabPali         = document.getElementById('tabPali');
      const tabEng          = document.getElementById('tabEng');
      const tabVie          = document.getElementById('tabVie');
      const colorContentPali = document.getElementById('colorContentPali');
      const colorContentEng  = document.getElementById('colorContentEng');
      const colorContentVie  = document.getElementById('colorContentVie');

      const paliBgInput     = document.getElementById('paliBg');
      const paliColorInput  = document.getElementById('paliColor');
      const engBgInput      = document.getElementById('engBg');
      const engColorInput   = document.getElementById('engColor');
      const vieBgInput      = document.getElementById('vieBg');
      const vieColorInput   = document.getElementById('vieColor');

      const resetPaliBtn    = document.getElementById('resetPali');
      const resetEngBtn     = document.getElementById('resetEng');
      const resetVieBtn     = document.getElementById('resetVie');

      const subTitle        = document.getElementById('sutraSubtitle');
      const backToTopBtn    = document.getElementById('backToTop');

      // Voice controls container
      const voiceControls   = document.getElementById('voiceControls');

      // N√∫t ƒë·ªçc VI / EN
      const btnReadVie      = document.getElementById('btnReadVie');
      const btnPauseVie     = document.getElementById('btnPauseVie');
      const btnRestartVie   = document.getElementById('btnRestartVie');
      const btnStopVie      = document.getElementById('btnStopVie');

      const btnReadEng      = document.getElementById('btnReadEng');
      const btnPauseEng     = document.getElementById('btnPauseEng');
      const btnRestartEng   = document.getElementById('btnRestartEng');
      const btnStopEng      = document.getElementById('btnStopEng');

      const sutraRows       = Array.from(grid.querySelectorAll('.sutra-row'));

      let showPali = true;
      let showEng  = true;
      let showVie  = true;

      const defaultColors = {
        paliBg: '#ffffff',
        paliColor: '#0f172a',
        engBg: '#ffffff',
        engColor: '#0f172a',
        vieBg: '#ffffff',
        vieColor: '#0f172a'
      };

      /* ==== Detect browser: ch·ªâ b·∫≠t voice cho Edge & Safari ==== */
      const ua = navigator.userAgent || '';
      const isEdge   = ua.includes('Edg/') || ua.includes('Edge/');
      const isSafari = ua.includes('Safari') &&
                       !ua.includes('Chrome') &&
                       !ua.includes('Chromium') &&
                       !ua.includes('Edg');

      const enableVoice = isEdge || isSafari;

      if(!enableVoice && voiceControls){
        voiceControls.style.display = 'none';
      }

      /* ======================= SETTINGS TOOLBAR TOGGLE ======================= */
      if (btnSettings && sutraControls) {
        btnSettings.addEventListener('click', function (e) {
          e.stopPropagation();
          const isOpen = sutraControls.classList.toggle('open');
          btnSettings.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        });

        // Click ngo√†i th√¨ ƒë√≥ng
        document.addEventListener('click', function (e) {
          if (!sutraControls.classList.contains('open')) return;
          const inside = sutraControls.contains(e.target) || btnSettings.contains(e.target);
          if (!inside) {
            sutraControls.classList.remove('open');
            btnSettings.setAttribute('aria-expanded','false');
          }
        });
      }

      /* ======================= SUBTITLE ======================= */
      function updateSubtitleByLang(){
        if(showEng && showVie){
          subTitle.innerHTML =
            'The Discourse on a Single Excellent Night<br>' +
            'Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£';
        }else if(showEng){
          subTitle.textContent = 'The Discourse on a Single Excellent Night';
        }else if(showVie){
          subTitle.textContent = 'Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£';
        }else{
          subTitle.textContent = '';
        }
      }

      /* ======================= LAYOUT & VISIBILITY ======================= */
      function adjustRowColumns(){
        const rows = grid.querySelectorAll('.sutra-row');
        rows.forEach(row=>{
          if(card.classList.contains('stack')){
            row.style.gridTemplateColumns = '1fr';
            return;
          }
          const cols = Array.from(row.querySelectorAll('.sutra-col'));
          const visible = cols.filter(col=>{
            if(col.classList.contains('pali-col') && !showPali) return false;
            if(col.classList.contains('eng-col')  && !showEng)  return false;
            if(col.classList.contains('vie-col')  && !showVie)  return false;
            return true;
          });
          const n = Math.max(1, visible.length);
          row.style.gridTemplateColumns = `repeat(${n},1fr)`;
        });
      }

      function updateVisibility(){
        grid.classList.toggle('hide-pali', !showPali);
        grid.classList.toggle('hide-eng',  !showEng);
        grid.classList.toggle('hide-vie',  !showVie);
        adjustRowColumns();
      }

      btnPali.addEventListener('click',()=>{
        showPali = !showPali;
        btnPali.classList.toggle('active', showPali);
        updateVisibility();
        updateSubtitleByLang();
      });

      btnEng.addEventListener('click',()=>{
        showEng = !showEng;
        btnEng.classList.toggle('active', showEng);
        updateVisibility();
        updateSubtitleByLang();
      });

      btnVie.addEventListener('click',()=>{
        showVie = !showVie;
        btnVie.classList.toggle('active', showVie);
        updateVisibility();
        updateSubtitleByLang();
      });

      btnLayout.addEventListener('click',()=>{
        card.classList.toggle('stack');
        const isStack = card.classList.contains('stack');
        layoutIcon.classList.toggle('vertical', isStack);
        adjustRowColumns();
      });

      /* ======================= OVERLAY COLOR ======================= */
      function setColorTab(lang){
        const isPali = lang === 'pali';
        const isEng  = lang === 'eng';
        const isVie  = lang === 'vie';

        tabPali.classList.toggle('active', isPali);
        tabEng.classList.toggle('active',  isEng);
        tabVie.classList.toggle('active',  isVie);

        colorContentPali.classList.toggle('d-none', !isPali);
        colorContentEng.classList.toggle('d-none',  !isEng);
        colorContentVie.classList.toggle('d-none',  !isVie);
      }

      function openColor(){
        colorOverlay.classList.add('show');
        colorOverlay.setAttribute('aria-hidden','false');
      }
      function closeColor(){
        colorOverlay.classList.remove('show');
        colorOverlay.setAttribute('aria-hidden','true');
      }

      btnColor.addEventListener('click',(e)=>{
        e.stopPropagation();
        openColor();
      });
      colorClose.addEventListener('click',(e)=>{
        e.stopPropagation();
        closeColor();
      });
      colorOverlay.addEventListener('click',(e)=>{
        if(e.target===colorOverlay) closeColor();
      });

      tabPali.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('pali'); });
      tabEng.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('eng'); });
      tabVie.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('vie'); });

      /* ======================= LOAD / SAVE M√ÄU ======================= */
      function loadColors(){
        let saved = {};
        try{
          saved = JSON.parse(localStorage.getItem('bh_colors') || '{}');
        }catch(e){
          saved = {};
        }

        const colors = {
          paliBg:   saved.paliBg   || defaultColors.paliBg,
          paliColor:saved.paliColor|| defaultColors.paliColor,
          engBg:    saved.engBg    || defaultColors.engBg,
          engColor: saved.engColor || defaultColors.engColor,
          vieBg:    saved.vieBg    || defaultColors.vieBg,
          vieColor: saved.vieColor || defaultColors.vieColor
        };

        paliBgInput.value    = colors.paliBg;
        paliColorInput.value = colors.paliColor;
        engBgInput.value     = colors.engBg;
        engColorInput.value  = colors.engColor;
        vieBgInput.value     = colors.vieBg;
        vieColorInput.value  = colors.vieColor;

        paliCols.forEach(c=>{
          c.style.background = colors.paliBg;
          c.style.color      = colors.paliColor;
        });
        engCols.forEach(c=>{
          c.style.background = colors.engBg;
          c.style.color      = colors.engColor;
        });
        vieCols.forEach(c=>{
          c.style.background = colors.vieBg;
          c.style.color      = colors.vieColor;
        });
      }

      function saveColors(){
        const obj = {
          paliBg:   paliBgInput.value   || defaultColors.paliBg,
          paliColor:paliColorInput.value|| defaultColors.paliColor,
          engBg:    engBgInput.value    || defaultColors.engBg,
          engColor: engColorInput.value || defaultColors.engColor,
          vieBg:    vieBgInput.value    || defaultColors.vieBg,
          vieColor: vieColorInput.value || defaultColors.vieColor
        };
        try{
          localStorage.setItem('bh_colors', JSON.stringify(obj));
        }catch(e){}
      }

      function setupColorControls(cols, bgInput, colorInput, resetBtn, defaults){
        bgInput.addEventListener('input', e=>{
          const value = e.target.value;
          cols.forEach(c=>{ c.style.background = value; });
          saveColors();
        });

        colorInput.addEventListener('input', e=>{
          const value = e.target.value;
          cols.forEach(c=>{ c.style.color = value; });
          saveColors();
        });

        resetBtn.addEventListener('click',()=>{
          cols.forEach(c=>{
            c.style.background = defaults.bg;
            c.style.color      = defaults.color;
          });
          bgInput.value    = defaults.bg;
          colorInput.value = defaults.color;
          saveColors();
        });
      }

      setupColorControls(
        paliCols,
        paliBgInput,
        paliColorInput,
        resetPaliBtn,
        {bg: defaultColors.paliBg, color: defaultColors.paliColor}
      );
      setupColorControls(
        engCols,
        engBgInput,
        engColorInput,
        resetEngBtn,
        {bg: defaultColors.engBg, color: defaultColors.engColor}
      );
      setupColorControls(
        vieCols,
        vieBgInput,
        vieColorInput,
        resetVieBtn,
        {bg: defaultColors.vieBg, color: defaultColors.vieColor}
      );

      /* ======================= BACK TO TOP ======================= */
      function setBackToTopVisible(visible){
        backToTopBtn.classList.toggle('show', visible);
        backToTopBtn.setAttribute('aria-hidden', visible ? 'false' : 'true');
      }

      grid.addEventListener('scroll', ()=>{
        setBackToTopVisible(grid.scrollTop > 0);
      }, { passive:true });

      backToTopBtn.addEventListener('click', ()=>{
        grid.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      /* ======================= ƒê·ªåC SUTRA (TTS) ‚Äì VI & EN ======================= */

      const synthSupported = enableVoice && ('speechSynthesis' in window);
      const synth = synthSupported ? window.speechSynthesis : null;

      let voices = [];

      function refreshVoices(){
        if(!synthSupported) return;
        voices = synth.getVoices() || [];
      }

      if(synthSupported){
        refreshVoices();
        if(typeof synth.onvoiceschanged !== 'undefined'){
          synth.onvoiceschanged = refreshVoices;
        }
      }

      function pickMaleVoice(langPrefix){
        if(!voices || !voices.length) return null;

        const langVoices = voices.filter(v =>
          v.lang && v.lang.toLowerCase().startsWith(langPrefix.toLowerCase())
        );
        if(!langVoices.length) return null;

        const maleHints = [
          'male','man','nam',
          'minh','quang','anh','d≈©ng','th√†nh',
          'david','john','michael','mark','alex','daniel','james'
        ];

        const maleVoice = langVoices.find(v =>
          maleHints.some(h => v.name.toLowerCase().includes(h))
        );

        return maleVoice || langVoices[0];
      }

      const readerState = {
        vie: { currentIndex: 0, isReading: false, isPaused: false },
        eng: { currentIndex: 0, isReading: false, isPaused: false }
      };

      let currentLang = null;     // 'vie' | 'eng' | null
      let currentUtterance = null;

      function saveReadState(){
        const data = {
          vie: { currentIndex: readerState.vie.currentIndex },
          eng: { currentIndex: readerState.eng.currentIndex }
        };
        try{
          localStorage.setItem('bh_readState', JSON.stringify(data));
        }catch(e){}
      }

      function loadReadState(){
        try{
          const raw = localStorage.getItem('bh_readState');
          if(!raw) return;
          const data = JSON.parse(raw);
          if(data.vie && Number.isInteger(data.vie.currentIndex)){
            readerState.vie.currentIndex = Math.min(
              Math.max(0, data.vie.currentIndex),
              Math.max(0, sutraRows.length - 1)
            );
          }
          if(data.eng && Number.isInteger(data.eng.currentIndex)){
            readerState.eng.currentIndex = Math.min(
              Math.max(0, data.eng.currentIndex),
              Math.max(0, sutraRows.length - 1)
            );
          }
        }catch(e){}
      }

      function clearHighlight(){
        sutraRows.forEach(r => r.classList.remove('reading'));
      }

      function setHighlightRow(row){
        clearHighlight();
        if(row){
          row.classList.add('reading');
          const top = row.offsetTop;
          const bottom = top + row.offsetHeight;
          const viewTop = grid.scrollTop;
          const viewBottom = viewTop + grid.clientHeight;

          if(top < viewTop || bottom > viewBottom){
            grid.scrollTo({ top: top - 20, behavior: 'smooth' });
          }
        }
      }

      function updateButtonsForLang(lang, mode){
        // mode: 'idle' | 'playing' | 'paused'
        if(lang === 'vie'){
          if(mode === 'idle'){
            btnReadVie.classList.remove('d-none');
            btnPauseVie.classList.add('d-none');
            btnRestartVie.classList.add('d-none');
            btnStopVie.classList.add('d-none');
            btnReadVie.textContent = 'üîä VI';
          }else if(mode === 'playing'){
            btnReadVie.classList.add('d-none');
            btnPauseVie.classList.remove('d-none');
            btnRestartVie.classList.remove('d-none');
            btnStopVie.classList.remove('d-none');
          }else if(mode === 'paused'){
            btnReadVie.classList.remove('d-none');
            btnPauseVie.classList.add('d-none');
            btnRestartVie.classList.remove('d-none');
            btnStopVie.classList.remove('d-none');
            btnReadVie.textContent = '‚ñ∂ VI';
          }
        }else if(lang === 'eng'){
          if(mode === 'idle'){
            btnReadEng.classList.remove('d-none');
            btnPauseEng.classList.add('d-none');
            btnRestartEng.classList.add('d-none');
            btnStopEng.classList.add('d-none');
            btnReadEng.textContent = 'üîä EN';
          }else if(mode === 'playing'){
            btnReadEng.classList.add('d-none');
            btnPauseEng.classList.remove('d-none');
            btnRestartEng.classList.remove('d-none');
            btnStopEng.classList.remove('d-none');
          }else if(mode === 'paused'){
            btnReadEng.classList.remove('d-none');
            btnPauseEng.classList.add('d-none');
            btnRestartEng.classList.remove('d-none');
            btnStopEng.classList.remove('d-none');
            btnReadEng.textContent = '‚ñ∂ EN';
          }
        }
      }

      function stopReading(lang){
        if(synthSupported){
          synth.cancel();
        }
        const st = readerState[lang];
        st.isReading = false;
        st.isPaused = false;
        currentUtterance = null;
        currentLang = null;
        updateButtonsForLang(lang,'idle');
        clearHighlight();
        saveReadState();
      }

      function stopAllSpeech(){
        if(synthSupported){
          synth.cancel();
        }
        currentUtterance = null;
        currentLang = null;
        readerState.vie.isReading = false;
        readerState.vie.isPaused  = false;
        readerState.eng.isReading = false;
        readerState.eng.isPaused  = false;
        updateButtonsForLang('vie','idle');
        updateButtonsForLang('eng','idle');
        clearHighlight();
      }

      function speakNextRow(lang){
        if(!synthSupported) return;

        const st = readerState[lang];
        if(!st.isReading || st.isPaused){
          return;
        }

        if(st.currentIndex >= sutraRows.length){
          st.isReading = false;
          st.isPaused  = false;
          updateButtonsForLang(lang,'idle');
          clearHighlight();
          saveReadState();
          return;
        }

        const row = sutraRows[st.currentIndex];
        let text = '';

        if(lang === 'vie'){
          const el = row.querySelector('.vie-col .vie');
          text = el ? el.innerText.trim() : '';
        }else if(lang === 'eng'){
          const el = row.querySelector('.eng-col .eng');
          text = el ? el.innerText.trim() : '';
        }

        if(!text){
          st.currentIndex++;
          saveReadState();
          speakNextRow(lang);
          return;
        }

        setHighlightRow(row);

        const utter = new SpeechSynthesisUtterance(text);

        if(lang === 'eng'){
          utter.lang = 'en-US';
          const v = pickMaleVoice('en');
          if(v) utter.voice = v;
        }else if(lang === 'vie'){
          utter.lang = 'vi-VN';
          const v = pickMaleVoice('vi');
          if(v) utter.voice = v;
          utter.pitch = 0.8;
          utter.rate  = 0.98;
        }

        currentUtterance = utter;
        currentLang = lang;

        utter.onend = function(){
          if(!st.isPaused && st.isReading){
            st.currentIndex++;
            saveReadState();
            speakNextRow(lang);
          }
        };

        utter.onerror = function(){
          st.isReading = false;
          st.isPaused  = false;
          updateButtonsForLang(lang,'idle');
        };

        synth.speak(utter);
      }

      function startReading(lang){
        if(!synthSupported){
          alert('Tr√¨nh duy·ªát hi·ªán t·∫°i kh√¥ng h·ªó tr·ª£ ƒë·ªçc gi·ªçng n√≥i ho·∫∑c ch·ª©c nƒÉng ƒë√£ t·∫Øt.');
          return;
        }

        if(currentLang && currentLang !== lang){
          stopAllSpeech();
        }else{
          if(readerState[lang].isReading && !readerState[lang].isPaused){
            return;
          }
        }

        const st = readerState[lang];
        st.isReading = true;
        st.isPaused  = false;

        updateButtonsForLang(lang,'playing');
        speakNextRow(lang);
      }

      function pauseReading(lang){
        if(!synthSupported) return;
        const st = readerState[lang];
        if(!st.isReading || st.isPaused) return;

        synth.pause();
        st.isPaused = true;
        st.isReading = false;
        updateButtonsForLang(lang,'paused');
        saveReadState();
      }

      function resumeReading(lang){
        if(!synthSupported) return;
        const st = readerState[lang];
        if(st.isPaused){
          synth.resume();
          st.isPaused = false;
          st.isReading = true;
          updateButtonsForLang(lang,'playing');
        }else{
          startReading(lang);
        }
      }

      function restartFromBeginning(lang){
        const st = readerState[lang];
        st.currentIndex = 0;
        st.isPaused = false;
        st.isReading = false;
        saveReadState();
        clearHighlight();
        if(synthSupported){
          synth.cancel();
        }
        startReading(lang);
      }

      /* G√°n event ch·ªâ khi enableVoice ƒë·ªÉ tr√°nh th·ª´a */
      if(enableVoice){
        // Vietnamese
        btnReadVie.addEventListener('click', ()=>{
          if(readerState.vie.isPaused){
            resumeReading('vie');
          }else{
            startReading('vie');
          }
        });

        btnPauseVie.addEventListener('click', ()=>{
          pauseReading('vie');
        });

        btnRestartVie.addEventListener('click', ()=>{
          restartFromBeginning('vie');
        });

        btnStopVie.addEventListener('click', ()=>{
          stopReading('vie');
        });

        // English
        btnReadEng.addEventListener('click', ()=>{
          if(readerState.eng.isPaused){
            resumeReading('eng');
          }else{
            startReading('eng');
          }
        });

        btnPauseEng.addEventListener('click', ()=>{
          pauseReading('eng');
        });

        btnRestartEng.addEventListener('click', ()=>{
          restartFromBeginning('eng');
        });

        btnStopEng.addEventListener('click', ()=>{
          stopReading('eng');
        });
      }

      /* ======================= INIT ======================= */
      function init(){
        setColorTab('pali');
        loadColors();
        loadReadState();
        updateVisibility();
        updateSubtitleByLang();
        layoutIcon.classList.remove('vertical');
        setBackToTopVisible(false);

        if(enableVoice){
          updateButtonsForLang('vie','idle');
          updateButtonsForLang('eng','idle');
        }
      }

      init();
    })();
  </script>
</body>
</html>
