<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NikƒÅya Archive ‚Äî Index</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#64748b;
      --accent:#2563eb;
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      padding:0;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:#0f172a;
      overflow:hidden; /* ki·ªÉu ‚Äúapp‚Äù, kh√¥ng scrollbar ngo√†i */
    }

    .page-wrapper{
      height:100%;
      display:flex;
      flex-direction:column;
    }

    header{
      flex:0 0 auto;
      background:linear-gradient(180deg, rgba(245,247,251,0.95), rgba(245,247,251,0.85));
      border-bottom:1px solid rgba(15,23,42,0.06);
    }

    header h1{
      text-transform:uppercase;
      letter-spacing:.03em;
      color:var(--accent);
      margin:0;
    }

    .main-container{
      flex:1 1 auto;
      padding:0.5rem 0;
      overflow:hidden;
    }

    footer{
      flex:0 0 auto;
      border-top:1px solid rgba(15,23,42,0.06);
      background:var(--bg);
      font-size:13px;
      color:var(--muted);
    }

    .main-container > .container{
      height:100%;
      padding-left:0.25rem;
      padding-right:0.25rem;
    }
    .main-container .row{
      height:100%;
      overflow:hidden;
      --bs-gutter-x:0.5rem;
    }

    .sidebar-wrapper{
      height:100%;
      transition:width .18s ease-out;
    }

    /* SIDEBAR */
    .sidebar{
      height:100%;
      max-height:100%;
      border-right:1px solid #e5e7eb;
      background:var(--card);
      padding:0.5rem 0.75rem;
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      font-size:13px;
      border-radius:12px;
    }
    .sidebar-section{margin-bottom:0.5rem;}

    .sidebar-toggle{
      width:100%;
      border:none;
      background:transparent;
      padding:4px 6px;
      text-align:left;
      font-weight:600;
      font-size:13px;
      color:#1e293b;
      display:flex;
      align-items:center;
      justify-content:space-between;
      cursor:pointer;
      border-radius:6px;
    }
    .sidebar-toggle:hover{background:rgba(37,99,235,0.06);}
    .sidebar-toggle .chevron{font-size:11px;opacity:0.7;}

    .sidebar-list{margin-top:2px;padding-left:4px;}
    .sidebar-list.collapsed{display:none;}

    .sutta-link{
      display:block;
      padding:3px 6px;
      border-radius:6px;
      text-decoration:none;
      color:#475569;
      font-size:13px;
      white-space:normal;
      word-break:break-word;
      line-height:1.4;
      transition:background-color .15s ease,color .15s ease;
    }
    .sutta-link:hover{
      background:rgba(37,99,235,0.08);
      color:#1d4ed8;
    }
    .sutta-link.active{
      background:var(--accent);
      color:#ffffff;
    }

    /* CONTENT + iframe */
    .content-wrapper{
      height:100%;
      display:flex;
      flex-direction:column;
      padding-left:0.25rem;
      min-width:0;
      /* b·ªè max-width ƒë·ªÉ kh√¥ng b·ªã h·∫πp h∆°n header */
      max-width:none;
      margin:0;
    }
    #sutraFrame{
      flex:1 1 auto;
      width:100%;
      height:100%;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:var(--card);
      display:block;
    }

    /* N√∫t header */
    .btn-header{
      min-width:96px;
      height:36px;
      padding:0 .75rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
      border-radius:10px; /* b·ªõt bo cong cho ƒë·ªìng b·ªô card */
      white-space:nowrap;
      background:#f8fafc;
      border:1px solid #e2e8f0;
      color:#475569;
    }
    .btn-header:hover{
      background:#e9eef5;
      border-color:#cbd5e1;
      color:#334155;
    }

    /* N√∫t Index h∆°i ‚Äúthu·ªôc v·ªÅ sidebar‚Äù */
    #btnSidebarToggle{
      background:#e5e9f2;
      border-color:#d1d5db;
      font-weight:500;
    }
    #btnSidebarToggle:hover{
      background:#dbe3f0;
    }

    .btn-lang{
      min-width:52px;
      padding:0 .5rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }

    /* Nh√≥m control b√™n ph·∫£i */
    .top-controls{
      display:flex;
      align-items:center;
      gap:6px;
      padding:3px 6px;
      border-radius:12px;
      background:#f8fafc;
      border:1px solid #e2e8f0;
      flex-wrap:wrap;          /* cho ph√©p xu·ªëng h√†ng khi h·∫πp */
      justify-content:flex-end;
    }

    /* HELP overlay */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }
    .overlay.show{display:flex;}
    .dialog{
      background:var(--card);
      border-radius:12px;
      padding:16px 20px;
      max-width:640px;
      width:90%;
      box-shadow:0 18px 45px rgba(15,23,42,0.35);
    }
    .dialog-close{
      border:none;
      background:transparent;
      font-size:20px;
      line-height:1;
      cursor:pointer;
      color:#64748b;
      padding-left:8px;
    }
    .dialog-close:hover{color:#0f172a;}

    /* Overlay cho mobile sidebar */
    .mobile-mask{
      display:none;
    }

    /* MOBILE: sidebar th√†nh drawer tr∆∞·ª£t */
    @media (max-width:768px){
         header .container{
    flex-direction:column;
    align-items:flex-start;
    gap:0.35rem;
  }
      .content-wrapper{
        padding-left:0;
        max-width:none;
      }

      .sidebar-wrapper{
        position:fixed;
        top:56px;        /* g·∫ßn b·∫±ng chi·ªÅu cao header */
        bottom:0;
        left:0;
        width:80%;
        max-width:320px;
        z-index:1200;
        transform:translateX(-100%);
        transition:transform .2s ease-out;
      }

      body.mobile-sidebar-open .sidebar-wrapper{
        transform:translateX(0);
      }

      .mobile-mask{
        position:fixed;
        inset:0;
        background:rgba(15,23,42,0.45);
        z-index:1100;
      }
      body.mobile-sidebar-open .mobile-mask{
        display:block;
      }

      /* Top controls g·ªçn l·∫°i */
      .btn-header{
         min-width:auto;
    padding:0 8px;
    font-size:13px;
    height:34px;
      }
      .top-controls{
        width:100%;
    justify-content:flex-start;
    padding:3px 0;
    border-radius:0;          /* b·ªè oval n·∫øu mu·ªën */
    background:transparent;   /* b·ªè n·ªÅn ngo√†i, ch·ªâ c√≤n n√∫t */
    border:none;
    gap:4px;
    flex-wrap:wrap;
      }
    }
  </style>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JYT2R1TWMR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-JYT2R1TWMR');
</script>

<body>
  <div class="page-wrapper">

    <!-- HEADER -->
    <header class="py-2">
      <div class="container d-flex align-items-center justify-content-between gap-2">
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-outline-secondary btn-sm btn-header" type="button" id="btnSidebarToggle">
            <span class="me-1">‚ò∞</span>
            <span data-text-vi="M·ª•c l·ª•c" data-text-en="Index">M·ª•c l·ª•c</span>
          </button>
          <h1 class="h5 mb-0">NIKƒÄYA</h1>
        </div>

        <!-- Nh√≥m control b√™n ph·∫£i -->
        <div class="top-controls">
          <button class="btn btn-outline-secondary btn-sm btn-header" type="button" id="btnPrev">
            <span>‚ü®</span>
            <span class="ms-1" data-text-vi="Kinh tr∆∞·ªõc" data-text-en="Previous">Kinh tr∆∞·ªõc</span>
          </button>
          <button class="btn btn-outline-secondary btn-sm btn-header" type="button" id="btnNext">
            <span data-text-vi="Kinh sau" data-text-en="Next">Kinh sau</span>
            <span class="ms-1">‚ü©</span>
          </button>
          <button class="btn btn-outline-secondary btn-sm btn-header" type="button" id="btnHelp">
            <span data-text-vi="H∆∞·ªõng d·∫´n" data-text-en="Help">H∆∞·ªõng d·∫´n</span>
          </button>

          <!-- N√∫t ng√¥n ng·ªØ -->
          <button class="btn btn-outline-secondary btn-sm btn-header btn-lang"
                  type="button"
                  id="btnLangVi"
                  title="Ti·∫øng Vi·ªát">
            VN
          </button>

          <button class="btn btn-outline-secondary btn-sm btn-header btn-lang"
                  type="button"
                  id="btnLangEn"
                  title="English">
            EN
          </button>
        </div>
      </div>
    </header>

    <!-- MAIN -->
    <main class="main-container">
      <div class="container h-100">
        <div class="row h-100">
          <!-- SIDEBAR -->
          <div class="col-12 col-md-4 col-lg-3 sidebar-wrapper" id="sidebarWrapper">
            <aside class="sidebar" id="sidebar">
              <!-- Dƒ´gha NikƒÅya -->
              <div class="sidebar-section">
                <button class="sidebar-toggle" type="button" data-target="listDN">
                  <span data-text-vi="Tr∆∞·ªùng B·ªô Kinh (Dƒ´gha)" data-text-en="Dƒ´gha NikƒÅya (Long Discourses)">
                    Tr∆∞·ªùng B·ªô Kinh (Dƒ´gha)
                  </span>
                  <span class="chevron">‚ñ∏</span>
                </button>
                <div id="listDN" class="sidebar-list collapsed">
                  <a href="dn01.html"
                     class="sutta-link"
                     data-title-pali="DN 1 ‚Äì BrahmajƒÅla Sutta"
                     data-title-vi="DN 1 ‚Äì BrahmajƒÅla Sutta ‚Äî Kinh Ph·∫°m V√µng">
                    DN 1 ‚Äì BrahmajƒÅla Sutta ‚Äî Kinh Ph·∫°m V√µng
                  </a>
                  <a href="dn02.html"
                     class="sutta-link"
                     data-title-pali="DN 2 ‚Äì SƒÅma√±√±aphala Sutta"
                     data-title-vi="DN 2 ‚Äì SƒÅma√±√±aphala Sutta ‚Äî Kinh Qu·∫£ B√°u Sa-m√¥n H·∫°nh">
                    DN 2 ‚Äì SƒÅma√±√±aphala Sutta ‚Äî Kinh Qu·∫£ B√°u Sa-m√¥n H·∫°nh
                  </a>
                </div>
              </div>

              <!-- Majjhima NikƒÅya -->
              <div class="sidebar-section">
                <button class="sidebar-toggle" type="button" data-target="listMN">
                  <span data-text-vi="Trung B·ªô Kinh (Majjhima)" data-text-en="Majjhima NikƒÅya (Middle-Length)">
                    Trung B·ªô Kinh (Majjhima)
                  </span>
                  <span class="chevron">‚ñæ</span>
                </button>
                <div id="listMN" class="sidebar-list">
                  <a href="mn001.html"
                     class="sutta-link"
                     data-title-pali="MN 1 ‚Äì M≈´lapariyƒÅya Sutta"
                     data-title-vi="MN 1 ‚Äì M≈´lapariyƒÅya Sutta ‚Äî Kinh CƒÉn B·∫£n Ph√°p M√¥n">
                    MN 1 ‚Äì M≈´lapariyƒÅya Sutta ‚Äî Kinh CƒÉn B·∫£n Ph√°p M√¥n
                  </a>
                  <a href="mn131-bhaddekaratta.html"
                     class="sutta-link"
                     data-title-pali="MN 131 ‚Äì Bhaddekaratta Sutta"
                     data-title-vi="MN 131 ‚Äì Bhaddekaratta Sutta ‚Äî Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£">
                    MN 131 ‚Äì Bhaddekaratta Sutta ‚Äî Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£
                  </a>
                  <a href="mn132.html"
                     class="sutta-link"
                     data-title-pali="MN 132 ‚Äì ƒÄnandabhaddekaratta Sutta"
                     data-title-vi="MN 132 ‚Äì ƒÄnandabhaddekaratta Sutta ‚Äî Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£ do T√¥n gi·∫£ A Nan Thuy·∫øt">
                    MN 132 ‚Äì ƒÄnandabhaddekaratta Sutta ‚Äî Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£ do T√¥n gi·∫£ A Nan Thuy·∫øt
                  </a>
                </div>
              </div>

              <!-- th√™m c√°c b·ªô kh√°c n·∫øu c·∫ßn -->
            </aside>
          </div>

          <!-- CONTENT (IFRAME) -->
          <div class="col-12 col-md-8 col-lg-9 content-wrapper" id="contentWrapper">
            <iframe id="sutraFrame" src="" title="Sutta content"></iframe>
          </div>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="py-2">
      <div class="container text-center">
        Namo Tassa Bhagavato Arahato SammƒÅsambuddhassa
      </div>
    </footer>
  </div>

  <!-- HELP OVERLAY -->
  <div id="helpOverlay" class="overlay" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="mb-0"
            data-text-vi="H∆∞·ªõng d·∫´n NikƒÅya Archive"
            data-text-en="NikƒÅya Archive Guide">
          H∆∞·ªõng d·∫´n NikƒÅya Archive
        </h2>
        <button type="button" class="dialog-close" id="helpClose">√ó</button>
      </div>

      <div id="helpContentVi">
        <p>M·ªôt v√†i g·ª£i √Ω s·ª≠ d·ª•ng:</p>
        <ul>
        <li>D√πng n√∫t <strong>‚ò∞ M·ª•c l·ª•c</strong> ƒë·ªÉ ·∫©n / hi·ªán danh m·ª•c kinh.</li>
          <li>Ch·ªçn m·ªôt b√†i kinh b√™n tr√°i, n·ªôi dung s·∫Ω ƒë∆∞·ª£c t·∫£i v√†o khung b√™n ph·∫£i.</li>
          <li>N√∫t <strong>‚ü® Kinh tr∆∞·ªõc</strong> v√† <strong>Kinh sau ‚ü©</strong> chuy·ªÉn qua l·∫°i gi·ªØa c√°c b√†i kinh theo ƒë√∫ng th·ª© t·ª± ƒëang hi·ªÉn th·ªã trong danh m·ª•c kinh.</li>
          <li>N√∫t <strong>VN / EN</strong> ƒë·ªïi ng√¥n ng·ªØ giao di·ªán.</li>
          <li>C√°c n√∫t <strong>PLI / EN / VI</strong> ·∫©n hi·ªán b·∫£ng d·ªãch t∆∞∆°ng ·ª©ng v·ªõi ng√¥n ng·ªØ c·ªßa b√†i kinh ƒë√≥</li>
          <li>N√∫t <strong>‚ò∞</strong> chuy·ªÉn view t·ª´ c·ªôt sang h√†ng v√† t·ª´ h√†ng sang c·ªôt</li>
          <li>N√∫t <strong>üé®</strong>ƒë·ªïi √†u n·ªÅn v√† m√†u ch·ª© t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng ng√¥n ng·ªØ trong b√†i kinh ƒë√≥</li>
        </ul>
        <p class="text-muted mb-0">B·∫•m ra ngo√†i khung ho·∫∑c n√∫t ‚úï ƒë·ªÉ ƒë√≥ng ph·∫ßn h∆∞·ªõng d·∫´n.</p>
      </div>

      <div id="helpContentEn" class="d-none">
        <p>Some quick tips:</p>
        <ul>
         <li>Use the <strong>‚ò∞ Table of Contents</strong> button to hide/show the scripture categories.</li>
<li>Select a sutta/reading on the left; its content will be loaded into the right panel.</li>
<li>The <strong>‚ü® Previous Sutta</strong> and <strong>Next Sutta ‚ü©</strong> buttons let you navigate between suttas in the exact order shown in the list.</li>
<li>The <strong>VN / EN</strong> button switches the interface language.</li>
<li>The <strong>PLI / EN / VI</strong> buttons show or hide the corresponding translation according to the language of that sutta.</li>
<li>The <strong>‚ò∞</strong> button switches the view between column and row layouts.</li>
<li>The <strong>üé®</strong> button changes the background and text colors corresponding to each language in that sutta.</li>

        </ul>
        <p class="text-muted mb-0">Click outside this dialog or press ‚úï to close the help overlay.</p>
      </div>
    </div>
  </div>

  <!-- overlay cho mobile sidebar -->
  <div id="mobileMask" class="mobile-mask"></div>

  <script>
    (function(){
      const sidebarWrapper   = document.getElementById('sidebarWrapper');
      const contentWrapper   = document.getElementById('contentWrapper');
      const btnSidebarToggle = document.getElementById('btnSidebarToggle');
      const sidebar          = document.getElementById('sidebar');
      const sutraFrame       = document.getElementById('sutraFrame');
      const btnPrev          = document.getElementById('btnPrev');
      const btnNext          = document.getElementById('btnNext');
      const btnHelp          = document.getElementById('btnHelp');
      const btnLangVi        = document.getElementById('btnLangVi');
      const btnLangEn        = document.getElementById('btnLangEn');
      const helpOverlay      = document.getElementById('helpOverlay');
      const helpClose        = document.getElementById('helpClose');
      const helpContentVi    = document.getElementById('helpContentVi');
      const helpContentEn    = document.getElementById('helpContentEn');
      const mobileMask       = document.getElementById('mobileMask');

      const LINK_KEY          = 'nikaya_last_sutta';
      const SIDEBAR_STATE_KEY = 'nikaya_sidebar_state';
      const LANG_KEY          = 'nikaya_ui_lang';
      const LANG_SIMPLE_KEY   = 'nikaya_lang'; // cho iframe

      const links     = document.querySelectorAll('.sutta-link');
      const langElems = document.querySelectorAll('[data-text-vi]');

      let currentHref = '';
      let currentLang = 'vi';

      function isMobile(){
        return window.innerWidth <= 768;
      }

      /* ========== UI LANGUAGE ========== */
      function setLang(lang){
        currentLang = (lang === 'en') ? 'en' : 'vi';
        try{
          localStorage.setItem(LANG_KEY, currentLang);
          localStorage.setItem(LANG_SIMPLE_KEY, currentLang);
        }catch(e){}

        langElems.forEach(el=>{
          const vi = el.getAttribute('data-text-vi') || '';
          const en = el.getAttribute('data-text-en') || '';
          el.textContent = currentLang === 'vi' ? vi : (en || vi);
        });

        links.forEach(a=>{
          const pali = a.dataset.titlePali || a.textContent.trim();
          const vi   = a.dataset.titleVi   || pali;
          a.textContent = currentLang === 'vi' ? vi : pali;
        });

        btnLangVi.classList.toggle('btn-lang-active', currentLang === 'vi');
        btnLangEn.classList.toggle('btn-lang-active', currentLang === 'en');

        const isVi = currentLang === 'vi';
        helpContentVi.classList.toggle('d-none', !isVi);
        helpContentEn.classList.toggle('d-none', isVi);
      }

      (function initLang(){
        let saved = 'vi';
        try{
          const v = localStorage.getItem(LANG_KEY);
          if(v === 'en' || v === 'vi') saved = v;
        }catch(e){}
        setLang(saved);
      })();

      btnLangVi.addEventListener('click',()=> setLang('vi'));
      btnLangEn.addEventListener('click',()=> setLang('en'));

      /* ========== SIDEBAR WIDTH / COLLAPSE ========== */
      function updateContentWidth(){
        if(!contentWrapper) return;
        const collapsed = sidebarWrapper && sidebarWrapper.classList.contains('d-none');
        if(collapsed){
          contentWrapper.classList.remove('col-md-8','col-lg-9');
          contentWrapper.classList.add('col-md-12','col-lg-12');
        }else{
          contentWrapper.classList.remove('col-md-12','col-lg-12');
          contentWrapper.classList.add('col-md-8','col-lg-9');
        }
      }

      if(btnSidebarToggle && sidebarWrapper){
        btnSidebarToggle.addEventListener('click',()=>{
          if(isMobile()){
            // mobile: toggle drawer
            document.body.classList.toggle('mobile-sidebar-open');
          }else{
            // desktop / tablet: ·∫©n/hi·ªán c·ªôt nh∆∞ c≈©
            sidebarWrapper.classList.toggle('d-none');
            updateContentWidth();
            saveSidebarState();
          }
        });
      }

      /* ========== SAVE / RESTORE SIDEBAR STATE ========== */
      function saveSidebarState(){
        if(!sidebar) return;
        const lists = document.querySelectorAll('.sidebar-list');
        const open = [];
        lists.forEach(list=>{
          if(!list.classList.contains('collapsed') && list.id){
            open.push(list.id);
          }
        });
        const state = {
          open,
          scrollTop: sidebar.scrollTop || 0,
          collapsed: sidebarWrapper ? sidebarWrapper.classList.contains('d-none') : false
        };
        try{
          localStorage.setItem(SIDEBAR_STATE_KEY, JSON.stringify(state));
        }catch(e){}
      }

      function restoreSidebarState(){
        if(!sidebar) return;
        let state = {};
        try{
          state = JSON.parse(localStorage.getItem(SIDEBAR_STATE_KEY) || '{}');
        }catch(e){ state = {}; }

        const lists = document.querySelectorAll('.sidebar-list');
        if(Array.isArray(state.open)){
          lists.forEach(list=>{
            if(state.open.includes(list.id)){
              list.classList.remove('collapsed');
            }else{
              list.classList.add('collapsed');
            }
          });
        }

        if(typeof state.scrollTop === 'number'){
          sidebar.scrollTop = state.scrollTop;
        }

        // kh√¥i ph·ª•c tr·∫°ng th√°i thu/m·ªü sidebar (ch·ªâ desktop / tablet)
        if(sidebarWrapper && typeof state.collapsed === 'boolean' && !isMobile()){
          sidebarWrapper.classList.toggle('d-none', state.collapsed);
        }

        const toggles = document.querySelectorAll('.sidebar-toggle');
        toggles.forEach(btn=>{
          const targetId = btn.getAttribute('data-target');
          const list = document.getElementById(targetId);
          const chev = btn.querySelector('.chevron');
          if(list && chev){
            chev.textContent = list.classList.contains('collapsed') ? '‚ñ∏' : '‚ñæ';
          }
        });

        updateContentWidth();
      }

      restoreSidebarState();

      const toggles = document.querySelectorAll('.sidebar-toggle');
      toggles.forEach(btn=>{
        const targetId = btn.getAttribute('data-target');
        const list = document.getElementById(targetId);
        const chev = btn.querySelector('.chevron');
        btn.addEventListener('click',()=>{
          if(!list || !chev) return;
          const collapsed = list.classList.toggle('collapsed');
          chev.textContent = collapsed ? '‚ñ∏' : '‚ñæ';
          saveSidebarState();
        });
      });

      /* ========== LOAD SUTTA ========== */
      function setActiveLink(href){
        links.forEach(a=>{
          a.classList.toggle('active', a.getAttribute('href') === href);
        });
      }

      function loadSutta(href){
        if(!href) return;
        sutraFrame.src = href;
        currentHref = href;
        setActiveLink(href);
        saveSidebarState();
        try{
          localStorage.setItem(LINK_KEY, href);
        }catch(e){}
        // ƒë√≥ng drawer sau khi ch·ªçn tr√™n mobile
        if(isMobile()){
          document.body.classList.remove('mobile-sidebar-open');
        }
      }

      links.forEach(a=>{
        a.addEventListener('click',(e)=>{
          e.preventDefault();
          const href = a.getAttribute('href');
          if(!href) return;
          loadSutta(href);
        });
      });

      let last = '';
      try{
        last = localStorage.getItem(LINK_KEY) || '';
      }catch(e){}
      if(!last){
        last = 'bg.html';   // trang m·∫∑c ƒë·ªãnh
      }
      loadSutta(last);

      /* ========== PREV / NEXT ========== */
      function goToOffset(offset){
        const hrefs = Array.from(links).map(a=>a.getAttribute('href'));
        if(!hrefs.length) return;
        let idx = hrefs.indexOf(currentHref);
        if(idx === -1) idx = 0;
        let targetIdx = idx + offset;
        if(targetIdx < 0) targetIdx = 0;
        if(targetIdx >= hrefs.length) targetIdx = hrefs.length - 1;
        const nextHref = hrefs[targetIdx];
        if(nextHref && nextHref !== currentHref){
          loadSutta(nextHref);
        }
      }

      btnPrev.addEventListener('click',()=> goToOffset(-1));
      btnNext.addEventListener('click',()=> goToOffset(1));

      /* ========== HELP DIALOG ========== */
      function openHelp(){
        helpOverlay.classList.add('show');
        helpOverlay.setAttribute('aria-hidden','false');
      }
      function closeHelp(){
        helpOverlay.classList.remove('show');
        helpOverlay.setAttribute('aria-hidden','true');
      }

      btnHelp.addEventListener('click',(e)=>{
        e.stopPropagation();
        openHelp();
      });
      helpClose.addEventListener('click',(e)=>{
        e.stopPropagation();
        closeHelp();
      });
      helpOverlay.addEventListener('click',(e)=>{
        if(e.target === helpOverlay) closeHelp();
      });

      /* ========== Mobile mask click ========== */
      if(mobileMask){
        mobileMask.addEventListener('click',()=>{
          document.body.classList.remove('mobile-sidebar-open');
        });
      }

      /* ========== Swipe m·ªü/ƒë√≥ng sidebar tr√™n mobile ========== */
      let touchStartX = 0;
      let touchEndX   = 0;

      document.addEventListener('touchstart', (e)=>{
        if(!isMobile()) return;
        if(!e.touches || !e.touches.length) return;
        touchStartX = e.touches[0].clientX;
      }, {passive:true});

      document.addEventListener('touchend', (e)=>{
        if(!isMobile()) return;
        if(!e.changedTouches || !e.changedTouches.length) return;
        touchEndX = e.changedTouches[0].clientX;
        const deltaX = touchEndX - touchStartX;

        // Vu·ªët t·ª´ tr√°i sang ph·∫£i ƒë·ªÉ m·ªü (b·∫Øt ƒë·∫ßu s√°t m√©p tr√°i)
        if(deltaX > 60 && touchStartX < 40 && !document.body.classList.contains('mobile-sidebar-open')){
          document.body.classList.add('mobile-sidebar-open');
          return;
        }

        // Vu·ªët t·ª´ ph·∫£i sang tr√°i ƒë·ªÉ ƒë√≥ng khi ƒëang m·ªü
        if(deltaX < -60 && document.body.classList.contains('mobile-sidebar-open')){
          document.body.classList.remove('mobile-sidebar-open');
        }
      }, {passive:true});

      window.addEventListener('beforeunload', saveSidebarState);
    })();
  </script>
</body>
</html>
