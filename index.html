<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NikƒÅya Archive ‚Äî Index</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#64748b;
      --accent:#2563eb;
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      padding:0;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:#0f172a;
      overflow:hidden;
    }

    .page-wrapper{
      height:100%;
      display:flex;
      flex-direction:column;
    }

    header{
      flex:0 0 auto;
      background:linear-gradient(180deg, rgba(245,247,251,0.95), rgba(245,247,251,0.85));
      border-bottom:1px solid rgba(15,23,42,0.06);
    }

    /* Ti√™u ƒë·ªÅ: in hoa + m√†u accent */
    header h1{
      text-transform:uppercase;
      letter-spacing:.03em;
      color:var(--accent);
      margin:0;
    }

    .main-container{
      flex:1 1 auto;
      padding:0.5rem 0;
      overflow:hidden;
    }

    footer{
      flex:0 0 auto;
      border-top:1px solid rgba(15,23,42,0.06);
      background:var(--bg);
      font-size:13px;
      color:var(--muted);
    }

    .sidebar-wrapper{
      height:100%;
    }

    /* SIDEBAR: n·ªÅn tr·∫Øng, bo g√≥c gi·ªëng iframe */
    .sidebar{
      height:100%;
      max-height:100%;
      border-right:1px solid #e5e7eb;
      background:var(--card);
      padding:0.5rem 0.75rem;
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      font-size:13px;
      border-radius:12px;
    }
    .sidebar-section{margin-bottom:0.5rem;}
    .sidebar-toggle{
      width:100%;
      border:none;
      background:transparent;
      padding:4px 6px;
      text-align:left;
      font-weight:600;
      font-size:13px;
      color:#1e293b;
      display:flex;
      align-items:center;
      justify-content:space-between;
      cursor:pointer;
      border-radius:6px;
    }
    .sidebar-toggle:hover{background:rgba(37,99,235,0.06);}
    .sidebar-toggle .chevron{font-size:11px;opacity:0.7;}
    .sidebar-list{margin-top:2px;padding-left:4px;}
    .sidebar-list.collapsed{display:none;}

    .sutta-link{
      display:block;
      padding:3px 6px;
      border-radius:6px;
      text-decoration:none;
      color:#475569;
      font-size:13px;
      white-space:normal;
      word-break:break-word;
      line-height:1.4;
      transition:background-color .15s ease,color .15s ease;
    }
    .sutta-link:hover{
      background:rgba(37,99,235,0.08);
      color:#1d4ed8;
    }
    /* M√†u ch·ªçn b√†i kinh: c√πng accent nh∆∞ n√∫t */
    .sutta-link.active{
      background:var(--accent);
      color:#ffffff;
    }

    /* CONTENT + iframe */
    .content-wrapper{
      height:100%;
      display:flex;
      flex-direction:column;
      padding-left:0.75rem;
    }
    #sutraFrame{
      flex:1 1 auto;
      width:100%;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:var(--card);
    }

    /* N√∫t header */
    .btn-header{
      min-width:96px;
      height:36px;
      padding:0 .75rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
      border-radius:8px;
      white-space:nowrap;
      background:#f8fafc;
      border:1px solid #e2e8f0;
      color:#475569;
    }
    .btn-header:hover{
      background:#e9eef5;
      border-color:#cbd5e1;
      color:#334155;
    }

    /* L√° c·ªù SVG trong n√∫t ng√¥n ng·ªØ */
    .btn-lang{
      min-width:52px;
      padding:0 .5rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .flag-icon{
      width:22px;
      height:16px;
      display:block;
      border-radius:2px;
      filter:grayscale(1) brightness(.9); /* x√°m khi ch∆∞a ch·ªçn */
      transition:.15s ease;
    }
    .btn-lang-active{
      background:var(--accent) !important;
      border-color:var(--accent) !important;
      color:#fff !important;
    }
    .btn-lang-active .flag-icon{
      filter:none; /* v·ªÅ m√†u g·ªëc khi ƒë∆∞·ª£c ch·ªçn */
    }

    /* HELP overlay */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }
    .overlay.show{display:flex;}
    .dialog{
      background:var(--card);
      border-radius:12px;
      padding:16px 20px;
      max-width:640px;
      width:90%;
      box-shadow:0 18px 45px rgba(15,23,42,0.35);
    }
    .dialog-close{
      border:none;
      background:transparent;
      font-size:20px;
      line-height:1;
      cursor:pointer;
      color:#64748b;
      padding-left:8px;
    }
    .dialog-close:hover{color:#0f172a;}

    @media (max-width:768px){
      .content-wrapper{padding-left:0;}
    }
  </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JYT2R1TWMR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JYT2R1TWMR');
</script>
<body>
  <div class="page-wrapper">

    <!-- HEADER -->
    <header class="py-2">
      <div class="container d-flex align-items-center justify-content-between gap-2">
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-outline-secondary btn-sm btn-header" type="button" id="btnSidebarToggle">
            <span class="me-1">‚ò∞</span>
            <span data-text-vi="M·ª•c l·ª•c" data-text-en="Index">M·ª•c l·ª•c</span>
          </button>
          <h1 id="sutraTitle" class="h5 mb-0">NIKƒÄYA ARCHIVE</h1>
        </div>
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-outline-secondary btn-sm btn-header" type="button" id="btnPrev">
            <span>‚ü®</span>
            <span class="ms-1" data-text-vi="Kinh tr∆∞·ªõc" data-text-en="Previous">Kinh tr∆∞·ªõc</span>
          </button>
          <button class="btn btn-outline-secondary btn-sm btn-header" type="button" id="btnNext">
            <span data-text-vi="Kinh sau" data-text-en="Next">Kinh sau</span>
            <span class="ms-1">‚ü©</span>
          </button>
          <button class="btn btn-outline-secondary btn-sm btn-header" type="button" id="btnHelp">
            <span data-text-vi="H∆∞·ªõng d·∫´n" data-text-en="Help">H∆∞·ªõng d·∫´n</span>
          </button>

          <!-- N√∫t ng√¥n ng·ªØ: l√° c·ªù SVG -->
          <button class="btn btn-outline-secondary btn-sm btn-header btn-lang"
                  type="button"
                  id="btnLangVi"
                  title="Ti·∫øng Vi·ªát">
            <svg class="flag-icon" viewBox="0 0 4 3" aria-hidden="true">
              <!-- n·ªÅn ƒë·ªè -->
              <rect width="4" height="3" fill="#da251d"></rect>
              <!-- sao v√†ng -->
              <polygon fill="#ffde00"
                points="2,0.45 2.25,1.3 3.15,1.3 2.4,1.85 2.65,2.7 2,2.2 1.35,2.7 1.6,1.85 0.85,1.3 1.75,1.3">
              </polygon>
            </svg>
          </button>

          <button class="btn btn-outline-secondary btn-sm btn-header btn-lang"
                  type="button"
                  id="btnLangEn"
                  title="English">
            <svg class="flag-icon" viewBox="0 0 4 3" aria-hidden="true">
              <!-- n·ªÅn xanh -->
              <rect width="4" height="3" fill="#012169"></rect>

              <!-- th·∫≠p tr·∫Øng ch√©o -->
              <polygon fill="#ffffff"
                points="0,0 0.5,0 4,2.25 4,3 3.5,3 0,0.75"></polygon>
              <polygon fill="#ffffff"
                points="4,0 3.5,0 0,2.25 0,3 0.5,3 4,0.75"></polygon>

              <!-- th·∫≠p ƒë·ªè ch√©o -->
              <polygon fill="#c8102e"
                points="0,0 0.25,0 4,2 4,2.25"></polygon>
              <polygon fill="#c8102e"
                points="4,0 3.75,0 0,2 0,2.25"></polygon>
              <polygon fill="#c8102e"
                points="0,3 0.25,3 4,1 4,0.75"></polygon>
              <polygon fill="#c8102e"
                points="4,3 3.75,3 0,1 0,0.75"></polygon>

              <!-- th·∫≠p tr·∫Øng d·ªçc/ngang -->
              <rect x="1.5" width="1" height="3" fill="#ffffff"></rect>
              <rect y="1" width="4" height="1" fill="#ffffff"></rect>

              <!-- th·∫≠p ƒë·ªè d·ªçc/ngang -->
              <rect x="1.75" width="0.5" height="3" fill="#c8102e"></rect>
              <rect y="1.25" width="4" height="0.5" fill="#c8102e"></rect>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- MAIN -->
    <main class="main-container">
      <div class="container h-100">
        <div class="row h-100">
          <!-- SIDEBAR -->
          <div class="col-12 col-md-4 col-lg-3 sidebar-wrapper" id="sidebarWrapper">
            <aside class="sidebar" id="sidebar">
              <!-- Tr∆∞·ªùng B·ªô Kinh -->
              <div class="sidebar-section">
                <button class="sidebar-toggle" type="button" data-target="listDN">
                  <span data-text-vi="Tr∆∞·ªùng B·ªô Kinh (Dƒ´gha)" data-text-en="Dƒ´gha NikƒÅya (Long Discourses)">
                    Tr∆∞·ªùng B·ªô Kinh (Dƒ´gha)
                  </span>
                  <span class="chevron">‚ñ∏</span>
                </button>
                <div id="listDN" class="sidebar-list collapsed">
                  <a href="dn01.html"
                     class="sutta-link"
                     data-title-pali="DN 1 ‚Äì BrahmajƒÅla Sutta"
                     data-title-vi="DN 1 ‚Äì BrahmajƒÅla Sutta ‚Äî Kinh Ph·∫°m V√µng">
                    DN 1 ‚Äì BrahmajƒÅla Sutta ‚Äî Kinh Ph·∫°m V√µng
                  </a>
                  <a href="dn02.html"
                     class="sutta-link"
                     data-title-pali="DN 2 ‚Äì SƒÅma√±√±aphala Sutta"
                     data-title-vi="DN 2 ‚Äì SƒÅma√±√±aphala Sutta ‚Äî Kinh Qu·∫£ B√°u Sa-m√¥n H·∫°nh">
                    DN 2 ‚Äì SƒÅma√±√±aphala Sutta ‚Äî Kinh Qu·∫£ B√°u Sa-m√¥n H·∫°nh
                  </a>
                </div>
              </div>

              <!-- Trung B·ªô Kinh -->
              <div class="sidebar-section">
                <button class="sidebar-toggle" type="button" data-target="listMN">
                  <span data-text-vi="Trung B·ªô Kinh (Majjhima)" data-text-en="Majjhima NikƒÅya (Middle-Length)">
                    Trung B·ªô Kinh (Majjhima)
                  </span>
                  <span class="chevron">‚ñæ</span>
                </button>
                <div id="listMN" class="sidebar-list">
                  <a href="mn001.html"
                     class="sutta-link"
                     data-title-pali="MN 1 ‚Äì M≈´lapariyƒÅya Sutta"
                     data-title-vi="MN 1 ‚Äì M≈´lapariyƒÅya Sutta ‚Äî Kinh CƒÉn B·∫£n Ph√°p M√¥n">
                    MN 1 ‚Äì M≈´lapariyƒÅya Sutta ‚Äî Kinh CƒÉn B·∫£n Ph√°p M√¥n
                  </a>
                  <a href="mn131-bhaddekaratta.html"
                     class="sutta-link"
                     data-title-pali="MN 131 ‚Äì Bhaddekaratta Sutta"
                     data-title-vi="MN 131 ‚Äì Bhaddekaratta Sutta ‚Äî Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£">
                    MN 131 ‚Äì Bhaddekaratta Sutta ‚Äî Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£
                  </a>
                  <a href="mn132.html"
                     class="sutta-link"
                     data-title-pali="MN 132 ‚Äì ƒÄnandabhaddekaratta Sutta"
                     data-title-vi="MN 132 ‚Äì ƒÄnandabhaddekaratta Sutta ‚Äî Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£ do T√¥n gi·∫£ A Nan Thuy·∫øt">
                    MN 132 ‚Äì ƒÄnandabhaddekaratta Sutta ‚Äî Kinh Nh·∫•t D·∫° Hi·ªÅn Gi·∫£ do T√¥n gi·∫£ A Nan Thuy·∫øt
                  </a>
                </div>
              </div>

              <!-- th√™m c√°c b·ªô kh√°c n·∫øu c·∫ßn -->
            </aside>
          </div>

          <!-- CONTENT (IFRAME) -->
          <div class="col-12 col-md-8 col-lg-9 content-wrapper" id="contentWrapper">
            <iframe id="sutraFrame" src="" title="Sutta content"></iframe>
          </div>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="py-2">
      <div class="container text-center">
        Namo Tassa Bhagavato Arahato SammƒÅsambuddhassa
      </div>
    </footer>
  </div>

  <!-- HELP OVERLAY -->
  <div id="helpOverlay" class="overlay" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="mb-0"
            data-text-vi="H∆∞·ªõng d·∫´n NikƒÅya Archive"
            data-text-en="NikƒÅya Archive Guide">
          H∆∞·ªõng d·∫´n NikƒÅya Archive
        </h2>
        <button type="button" class="dialog-close" id="helpClose">√ó</button>
      </div>

      <div id="helpContentVi">
        <p>M·ªôt v√†i g·ª£i √Ω s·ª≠ d·ª•ng:</p>
        <ul>
          <li>D√πng n√∫t <strong>‚ò∞ M·ª•c l·ª•c</strong> ƒë·ªÉ ·∫©n/hi·ªán thanh b√™n tr√°i ch·ª©a danh s√°ch NikƒÅya v√† c√°c b√†i kinh.</li>
          <li>Khi ch·ªçn m·ªôt b√†i kinh b√™n tr√°i, n·ªôi dung s·∫Ω ƒë∆∞·ª£c t·∫£i trong khung b√™n ph·∫£i.</li>
          <li>N√∫t <strong>‚ü® Kinh tr∆∞·ªõc</strong> v√† <strong>Kinh sau ‚ü©</strong> chuy·ªÉn qua l·∫°i gi·ªØa c√°c b√†i kinh theo th·ª© t·ª± trong m·ª•c l·ª•c.</li>
          <li>N√∫t l√° c·ªù <strong>üáªüá≥ / üá¨üáß</strong> ƒë·ªïi ng√¥n ng·ªØ giao di·ªán (m·ª•c l·ª•c, n√∫t ƒëi·ªÅu h∆∞·ªõng, ph·∫ßn h∆∞·ªõng d·∫´n, v.v.).</li>
          <li>C√°c n√∫t PƒÅli / English / Ti·∫øng Vi·ªát, Row/Col, M√†u‚Ä¶ n·∫±m trong t·ª´ng trang kinh (HTML con) v√† ch·ªâ ·∫£nh h∆∞·ªüng b√†i kinh ƒë√≥.</li>
        </ul>
        <p class="text-muted mb-0">B·∫•m ra ngo√†i khung ho·∫∑c n√∫t ‚úï ƒë·ªÉ ƒë√≥ng ph·∫ßn h∆∞·ªõng d·∫´n.</p>
      </div>

      <div id="helpContentEn" class="d-none">
        <p>Some quick tips:</p>
        <ul>
          <li>Use the <strong>‚ò∞ Index</strong> button to show/hide the left sidebar with NikƒÅya collections and suttas.</li>
          <li>When you select a sutta on the left, its content is loaded in the right iframe.</li>
          <li>The <strong>‚ü® Previous</strong> and <strong>Next ‚ü©</strong> buttons move between suttas in the current sidebar order.</li>
          <li>The flag buttons <strong>üáªüá≥ / üá¨üáß</strong> switch the interface language (sidebar headings, navigation buttons, this help text, etc.).</li>
          <li>Per-sutta controls (PƒÅli / English / Vietnamese, Row/Col, Color‚Ä¶) live inside each sutta HTML page and affect only that page.</li>
        </ul>
        <p class="text-muted mb-0">Click outside this dialog or press ‚úï to close the help overlay.</p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const sidebarWrapper   = document.getElementById('sidebarWrapper');
      const contentWrapper   = document.getElementById('contentWrapper');
      const btnSidebarToggle = document.getElementById('btnSidebarToggle');
      const sidebar          = document.getElementById('sidebar');
      const sutraFrame       = document.getElementById('sutraFrame');
      const btnPrev          = document.getElementById('btnPrev');
      const btnNext          = document.getElementById('btnNext');
      const btnHelp          = document.getElementById('btnHelp');
      const btnLangVi        = document.getElementById('btnLangVi');
      const btnLangEn        = document.getElementById('btnLangEn');
      const helpOverlay      = document.getElementById('helpOverlay');
      const helpClose        = document.getElementById('helpClose');
      const helpContentVi    = document.getElementById('helpContentVi');
      const helpContentEn    = document.getElementById('helpContentEn');
      const headerTitle      = document.getElementById('sutraTitle');

      const LINK_KEY          = 'nikaya_last_sutta';
      const SIDEBAR_STATE_KEY = 'nikaya_sidebar_state';
      const LANG_KEY          = 'nikaya_ui_lang';
      const LANG_SIMPLE_KEY   = 'nikaya_lang'; // cho iframe

      const links     = document.querySelectorAll('.sutta-link');
      const langElems = document.querySelectorAll('[data-text-vi]');

      let currentHref = '';
      let currentLang = 'vi';

      /* ====== c·∫≠p nh·∫≠t ti√™u ƒë·ªÅ header theo b√†i kinh ====== */
      function updateHeaderTitle(){
        const defaultTitle = 'NIKƒÄYA ARCHIVE';
        if(!currentHref || currentHref === 'bg.html'){
          headerTitle.textContent = defaultTitle;
          return;
        }
        let matched = null;
        links.forEach(a=>{
          if(a.getAttribute('href') === currentHref){
            matched = a;
          }
        });
        if(!matched){
          headerTitle.textContent = defaultTitle;
          return;
        }
        const pali = matched.dataset.titlePali || matched.textContent.trim();
        const vi   = matched.dataset.titleVi   || pali;
        const t    = (currentLang === 'vi') ? vi : pali;
        headerTitle.textContent = t.toUpperCase();
      }

      /* ====== ƒë·ªïi ng√¥n ng·ªØ giao di·ªán ====== */
      function setLang(lang){
        currentLang = (lang === 'en') ? 'en' : 'vi';
        try{
          localStorage.setItem(LANG_KEY, currentLang);
          localStorage.setItem(LANG_SIMPLE_KEY, currentLang); // iframe ƒë·ªçc
        }catch(e){}

        // ƒë·ªïi text cho ph·∫ßn c√≥ data-text-vi / data-text-en
        langElems.forEach(el=>{
          const vi = el.getAttribute('data-text-vi') || '';
          const en = el.getAttribute('data-text-en') || '';
          el.textContent = currentLang === 'vi' ? vi : (en || vi);
        });

        // ƒë·ªïi label hi·ªÉn th·ªã trong m·ª•c l·ª•c
        links.forEach(a=>{
          const pali = a.dataset.titlePali || a.textContent.trim();
          const vi   = a.dataset.titleVi   || pali;
          a.textContent = currentLang === 'vi' ? vi : pali;
        });

        // tr·∫°ng th√°i n√∫t c·ªù
        btnLangVi.classList.toggle('btn-lang-active', currentLang === 'vi');
        btnLangEn.classList.toggle('btn-lang-active', currentLang === 'en');

        // help content
        const isVi = currentLang === 'vi';
        helpContentVi.classList.toggle('d-none', !isVi);
        helpContentEn.classList.toggle('d-none', isVi);

        updateHeaderTitle();
      }

      (function initLang(){
        let saved = 'vi';
        try{
          const v = localStorage.getItem(LANG_KEY);
          if(v === 'en' || v === 'vi') saved = v;
        }catch(e){}
        setLang(saved);
      })();

      btnLangVi.addEventListener('click',()=> setLang('vi'));
      btnLangEn.addEventListener('click',()=> setLang('en'));

      /* ====== sidebar ·∫©n/hi·ªán + d√£n content ====== */
      function updateContentWidth(){
        if(!contentWrapper) return;
        if(sidebarWrapper && sidebarWrapper.classList.contains('d-none')){
          contentWrapper.classList.remove('col-md-8','col-lg-9');
          contentWrapper.classList.add('col-md-12','col-lg-12');
        }else{
          contentWrapper.classList.remove('col-md-12','col-lg-12');
          contentWrapper.classList.add('col-md-8','col-lg-9');
        }
      }

      if(btnSidebarToggle && sidebarWrapper){
        btnSidebarToggle.addEventListener('click',()=>{
          sidebarWrapper.classList.toggle('d-none');
          updateContentWidth();
        });
      }

      /* ====== l∆∞u / kh√¥i ph·ª•c tr·∫°ng th√°i sidebar (m·ªü / scroll) ====== */
      function saveSidebarState(){
        if(!sidebar) return;
        const lists = document.querySelectorAll('.sidebar-list');
        const open = [];
        lists.forEach(list=>{
          if(!list.classList.contains('collapsed') && list.id){
            open.push(list.id);
          }
        });
        const state = {
          open,
          scrollTop: sidebar.scrollTop || 0
        };
        try{
          localStorage.setItem(SIDEBAR_STATE_KEY, JSON.stringify(state));
        }catch(e){}
      }

      function restoreSidebarState(){
        if(!sidebar) return;
        let state = {};
        try{
          state = JSON.parse(localStorage.getItem(SIDEBAR_STATE_KEY) || '{}');
        }catch(e){ state = {}; }

        const lists = document.querySelectorAll('.sidebar-list');
        if(Array.isArray(state.open)){
          lists.forEach(list=>{
            if(state.open.includes(list.id)){
              list.classList.remove('collapsed');
            }else{
              list.classList.add('collapsed');
            }
          });
        }
        if(typeof state.scrollTop === 'number'){
          sidebar.scrollTop = state.scrollTop;
        }

        // c·∫≠p nh·∫≠t chevron
        const toggles = document.querySelectorAll('.sidebar-toggle');
        toggles.forEach(btn=>{
          const targetId = btn.getAttribute('data-target');
          const list = document.getElementById(targetId);
          const chev = btn.querySelector('.chevron');
          if(list && chev){
            chev.textContent = list.classList.contains('collapsed') ? '‚ñ∏' : '‚ñæ';
          }
        });
      }

      restoreSidebarState();

      const toggles = document.querySelectorAll('.sidebar-toggle');
      toggles.forEach(btn=>{
        const targetId = btn.getAttribute('data-target');
        const list = document.getElementById(targetId);
        const chev = btn.querySelector('.chevron');
        btn.addEventListener('click',()=>{
          if(!list || !chev) return;
          const collapsed = list.classList.toggle('collapsed');
          chev.textContent = collapsed ? '‚ñ∏' : '‚ñæ';
          saveSidebarState();
        });
      });

      /* ====== ch·ªçn b√†i kinh -> iframe + active ====== */
      function setActiveLink(href){
        links.forEach(a=>{
          a.classList.toggle('active', a.getAttribute('href') === href);
        });
      }

      function loadSutta(href){
        if(!href) return;
        sutraFrame.src = href;
        currentHref = href;
        setActiveLink(href);
        saveSidebarState();
        try{
          localStorage.setItem(LINK_KEY, href);
        }catch(e){}
        updateHeaderTitle();
      }

      links.forEach(a=>{
        a.addEventListener('click',(e)=>{
          e.preventDefault();
          const href = a.getAttribute('href');
          if(!href) return;
          loadSutta(href);
        });
      });

      /* ====== kh√¥i ph·ª•c b√†i kinh cu·ªëi, m·∫∑c ƒë·ªãnh bg.html ====== */
      let last = '';
      try{
        last = localStorage.getItem(LINK_KEY) || '';
      }catch(e){}
      if(!last){
        last = 'bg.html';
      }
      loadSutta(last);

      /* ====== Kinh tr∆∞·ªõc / sau ====== */
      function goToOffset(offset){
        const hrefs = Array.from(links).map(a=>a.getAttribute('href'));
        if(!hrefs.length) return;
        let idx = hrefs.indexOf(currentHref);
        if(idx === -1) idx = 0;
        let targetIdx = idx + offset;
        if(targetIdx < 0) targetIdx = 0;
        if(targetIdx >= hrefs.length) targetIdx = hrefs.length - 1;
        const nextHref = hrefs[targetIdx];
        if(nextHref && nextHref !== currentHref){
          loadSutta(nextHref);
        }
      }

      btnPrev.addEventListener('click',()=> goToOffset(-1));
      btnNext.addEventListener('click',()=> goToOffset(1));

      /* ====== Help overlay ====== */
      function openHelp(){
        helpOverlay.classList.add('show');
        helpOverlay.setAttribute('aria-hidden','false');
      }
      function closeHelp(){
        helpOverlay.classList.remove('show');
        helpOverlay.setAttribute('aria-hidden','true');
      }
      btnHelp.addEventListener('click',(e)=>{
        e.stopPropagation();
        openHelp();
      });
      helpClose.addEventListener('click',(e)=>{
        e.stopPropagation();
        closeHelp();
      });
      helpOverlay.addEventListener('click',(e)=>{
        if(e.target === helpOverlay) closeHelp();
      });

      window.addEventListener('beforeunload', saveSidebarState);
      updateContentWidth();
    })();
  </script>
</body>
</html>
