<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bhaddekaratta â€” PÄli / English / Tiáº¿ng Viá»‡t (Bootstrap)</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#64748b;
      --accent:#2563eb;
    }
    *{box-sizing:border-box}

    /* CHá»T: body + html full viewport, khÃ´ng scroll ngoÃ i */
    html,body{
      height:100%;
      margin:0;
      padding:0;
      overflow:hidden;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:#0f172a;
    }

    /* hiá»‡u á»©ng trÆ°á»£t khi quay láº¡i danh má»¥c */
    body{
      transform:translateX(0);
      transition:transform .25s ease;
    }
    body.page-slide-out{
      transform:translateX(-100%);
    }

    header{
      position:sticky;
      top:0;
      z-index:1040;
      background:linear-gradient(180deg, rgba(245,247,251,0.95), rgba(245,247,251,0.85));
      backdrop-filter:blur(4px);
      border-bottom:1px solid rgba(15,23,42,0.06);
    }

    .page-wrapper{
      height:100dvh; /* chuáº©n cho iOS/iPad */
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    .main-container{
      flex:1 1 auto;
      padding-top:0.5rem;
      padding-bottom:0.5rem;
    }

    .sutra-card{
      background:var(--card);
      border-radius:12px;
      border:1px solid #e6edf7;
      padding:14px;
      display:flex;
      flex-direction:column;
    }

    .sutra-grid{display:flex;flex-direction:column;gap:10px;}

    .sutra-row{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:12px;
      padding:12px;
      border-radius:8px;
    }
    .sutra-row:nth-child(odd){
      background:rgba(37,99,235,0.03);
    }

    .sutra-col{
      min-height:1px;
      padding:8px;
      border-radius:6px;
    }

    .pali{font-family:"Noto Serif",serif;font-size:15px;line-height:1.6}
    .eng{font-family:Georgia,serif;font-size:14px;line-height:1.6}
    .vie{font-family:system-ui;font-size:14px;line-height:1.6}
    .col-head{font-weight:600;color:var(--muted);font-size:13px;margin-bottom:6px}

    /* hide states */
    .hide-pali .pali-col{display:none;}
    .hide-eng  .eng-col {display:none;}
    .hide-vie  .vie-col {display:none;}

    /* layout stack */
    .stack .sutra-row{grid-template-columns:1fr;}

    footer{
      border-top:1px solid rgba(15,23,42,0.06);
      background:var(--bg);
      font-size:13px;
      color:var(--muted);
    }

    /* unify button sizes */
    .controls .btn,
    header .btn{
      min-width:96px;
      height:36px;
      padding:0 .75rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
      border-radius:8px;
      white-space:nowrap;
    }

    /* vÃ¹ng scroll duy nháº¥t bÃªn trong card */
    #sutraCardScroll{
      flex:1;
      overflow-y:auto;
      overscroll-behavior:contain;
      -webkit-overflow-scrolling:touch;
    }

    /* overlay dÃ¹ng chung cho Help & Color */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }
    .overlay.show{
      display:flex;
    }
    .dialog{
      background:var(--card);
      border-radius:12px;
      padding:16px 20px;
      max-width:640px;
      width:90%;
      box-shadow:0 18px 45px rgba(15,23,42,0.35);
    }
    .dialog h2{
      font-size:18px;
      margin:0 0 8px 0;
    }
    .dialog p,
    .dialog li{
      font-size:14px;
    }
    .dialog-close{
      border:none;
      background:transparent;
      font-size:20px;
      line-height:1;
      cursor:pointer;
      color:#64748b;
      padding-left:8px;
    }
    .dialog-close:hover{
      color:#0f172a;
    }

    .tab-btn.active{
      background-color:var(--accent);
      color:#fff !important;
    }

    /* tiÃªu Ä‘á» bÃ i kinh dáº¡ng nÃºt, khÃ´ng click Ä‘Æ°á»£c */
    .sutta-title{
      cursor:default;
      font-weight:600;
      background:var(--card);
      border-color:rgba(15,23,42,0.15);
      color:#0f172a;
      pointer-events:none;
      box-shadow:0 2px 8px rgba(15,23,42,0.08);
    }

    @media (max-width: 768px){
      .sutra-row{
        grid-template-columns:1fr;
      }
      .controls .btn, header .btn{
        min-width:80px;
      }
    }
  </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JYT2R1TWMR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JYT2R1TWMR');
</script>
<body>
  <div class="page-wrapper">

    <!-- HEADER -->
    <header class="py-2">
      <div class="container d-flex align-items-center justify-content-between gap-2">
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="btnBack">
            â† Danh má»¥c
          </button>

          <!-- NhÃ³m bÃ i trÆ°á»›c / tiÃªu Ä‘á» / bÃ i sau -->
          <div class="d-flex align-items-center gap-2">
            <button class="btn btn-outline-secondary btn-sm" type="button" id="btnPrevSutta">
              â€¹ BÃ i trÆ°á»›c
            </button>

            <div id="suttaTitle" class="btn btn-outline-secondary btn-sm sutta-title">
              Bhaddekaratta
            </div>

            <button class="btn btn-outline-secondary btn-sm" type="button" id="btnNextSutta">
              BÃ i sau â€º
            </button>
          </div>
        </div>

        <div class="controls d-flex flex-wrap align-items-center gap-2">
          <!-- NgÃ´n ngá»¯: chá»‰ áº©n / hiá»‡n -->
          <div class="btn-group btn-group-sm" role="group" aria-label="NgÃ´n ngá»¯">
            <button type="button" class="btn btn-outline-secondary active" id="btnPali">PÄli</button>
            <button type="button" class="btn btn-outline-secondary active" id="btnEng">Tiáº¿ng Anh</button>
            <button type="button" class="btn btn-outline-secondary active" id="btnVie">Tiáº¿ng Viá»‡t</button>
          </div>

          <!-- Actions -->
          <button id="btnLayout" class="btn btn-outline-secondary btn-sm" type="button">
            Row
          </button>
          <button id="btnFull" class="btn btn-outline-secondary btn-sm" type="button">
            â¤¢ ToÃ n mÃ n
          </button>
          <button id="btnColor" class="btn btn-outline-secondary btn-sm" type="button">
            ğŸ¨ MÃ u
          </button>
          <button id="btnHelp" class="btn btn-outline-secondary btn-sm" type="button">
            Help
          </button>
        </div>
      </div>
    </header>

    <!-- MAIN -->
    <main class="main-container">
      <div id="mainContainer" class="container">
        <div class="sutra-card" id="sutraCard">

          <div id="sutraCardScroll">
            <div id="sutraGrid" class="sutra-grid">

              <!-- Row 1 -->
              <div class="sutra-row" data-idx="1" id="row-1">
                <div class="sutra-col pali-col">
                  <div class="col-head">Bhaddekaratta (PÄli)</div>
                  <div class="pali">
                    Evaá¹ me sutaá¹: Ekaá¹ samayaá¹ bhagavÄ sÄvatthiyaá¹ vihÄrati jetavane anÄthapiá¹‡á¸ikassa ÄrÄme.
                  </div>
                </div>
                <div class="sutra-col eng-col">
                  <div class="col-head">Bhaddekaratta (English)</div>
                  <div class="eng">
                    Thus have I heard: At one time the Blessed One was dwelling at SÄvatthÄ«, in Jeta's Grove, AnÄthapiá¹‡á¸ika's Park.
                  </div>
                </div>
                <div class="sutra-col vie-col">
                  <div class="col-head">Kinh Nháº¥t Dáº¡ Hiá»n Giáº£</div>
                  <div class="vie">
                    Nghe nhÆ° váº§y: CÃ³ má»™t thá»i, Tháº¿ TÃ´n trÃº táº¡i XÃ¡-vá»‡, trong rá»«ng Ká»³-Ä‘Ã , táº¡i khu vÆ°á»n cá»§a AnÄthapiá¹‡á¸ika.
                  </div>
                </div>
              </div>

              <!-- Row 2 -->
              <div class="sutra-row" data-idx="2" id="row-2">
                <div class="sutra-col pali-col">
                  <div class="pali">
                    Tatra kho bhagavÄ bhikkhÅ« Ämantesi: â€œBhikkhavoâ€ti. â€œBhaddanteâ€ti te bhikkhÅ« bhagavato paccassosuá¹.
                  </div>
                </div>
                <div class="sutra-col eng-col">
                  <div class="eng">
                    There the Blessed One addressed the bhikkhus: "Bhikkhus!" "Venerable sir," the bhikkhus replied to the Blessed One.
                  </div>
                </div>
                <div class="sutra-col vie-col">
                  <div class="vie">
                    á» Ä‘Ã³ Tháº¿ TÃ´n nÃ³i vá»›i cÃ¡c tá»³-kheo: â€œNÃ y cÃ¡c tá»³-kheo.â€ â€œBáº¡ch trÆ°á»Ÿng lÃ£o,â€ cÃ¡c tá»³-kheo tráº£ lá»i Äá»©c Pháº­t.
                  </div>
                </div>
              </div>

              <!-- Row 3 -->
              <div class="sutra-row" data-idx="3" id="row-3">
                <div class="sutra-col pali-col">
                  <div class="pali">
                    AtÄ«taá¹ nÄnvÄgameyya, nappaá¹­ikaá¹…khe anÄgataá¹; yadatÄ«taá¹ pahÄ«naá¹ taá¹, appattaÃ±ca anÄgataá¹.
                  </div>
                </div>
                <div class="sutra-col eng-col">
                  <div class="eng">
                    Let the past not be clung to; the future not expected; whatever is past has been left behind, and the future is not yet come.
                  </div>
                </div>
                <div class="sutra-col vie-col">
                  <div class="vie">
                    Äá»«ng bÃ¡m vÃ­u vÃ o quÃ¡ khá»©, Ä‘á»«ng mong chá» tÆ°Æ¡ng lai; Ä‘iá»u Ä‘Ã£ qua Ä‘Ã£ bá», Ä‘iá»u tÆ°Æ¡ng lai chÆ°a Ä‘áº¿n.
                  </div>
                </div>
              </div>

              <!-- Row 4 -->
              <div class="sutra-row" data-idx="4" id="row-4">
                <div class="sutra-col pali-col">
                  <div class="pali">
                    Idamavoca bhagavÄ. AttamanÄ te bhikkhÅ« bhagavato bhÄsitaá¹ abhinandunti. Bhaddekarattasuttaá¹ niá¹­á¹­hitaá¹.
                  </div>
                </div>
                <div class="sutra-col eng-col">
                  <div class="eng">
                    Thus the Blessed One spoke. The bhikkhus were glad and praised what had been said by the Blessed One. The Bhaddekaratta Sutta is concluded.
                  </div>
                </div>
                <div class="sutra-col vie-col">
                  <div class="vie">
                    Äá»©c Pháº­t thuyáº¿t xong. CÃ¡c tá»³-kheo hoan há»· vÃ  tÃ¡n thÃ¡n lá»i Pháº­t dáº¡y. Kinh Bhaddekaratta káº¿t thÃºc.
                  </div>
                </div>
              </div>

            </div>
          </div>

          <p class="text-muted small mt-2 mb-0">
            Gá»£i Ã½: dÃ¹ng 3 nÃºt PÄli / Tiáº¿ng Anh / Tiáº¿ng Viá»‡t Ä‘á»ƒ áº©n/hiá»‡n tá»«ng cá»™t. 
            NÃºt "Row" chuyá»ƒn giá»¯a nhiá»u cá»™t vÃ  xáº¿p chá»“ng (Col). 
            NÃºt "â¤¢ ToÃ n mÃ n" báº­t/táº¯t cháº¿ Ä‘á»™ full-width. 
            NÃºt "ğŸ¨ MÃ u" má»Ÿ báº£ng chá»‰nh mÃ u chá»¯ &amp; mÃ u ná»n cho tá»«ng ngÃ´n ngá»¯. 
            NÃºt "Help" xem hÆ°á»›ng dáº«n chi tiáº¿t.
          </p>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="py-2">
      <div class="container text-center">
        Â© 2025 Bhaddekaratta â€” All rights reserved.
      </div>
    </footer>
  </div>

  <!-- HELP OVERLAY -->
  <div id="helpOverlay" class="overlay" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 id="helpTitle" class="mb-0">Help / HÆ°á»›ng dáº«n</h2>
        <div class="d-flex align-items-center gap-2">
          <div class="btn-group btn-group-sm" role="tablist">
            <button type="button" class="btn btn-outline-secondary active" id="helpTabVi">
              Tiáº¿ng Viá»‡t
            </button>
            <button type="button" class="btn btn-outline-secondary" id="helpTabEn">
              English
            </button>
          </div>
          <button type="button" class="dialog-close" id="helpClose" aria-label="ÄÃ³ng">Ã—</button>
        </div>
      </div>

      <!-- Ná»™i dung Tiáº¿ng Viá»‡t -->
      <div id="helpContentVi">
        <p>Má»™t sá»‘ gá»£i Ã½ thao tÃ¡c nhanh trÃªn trang Bhaddekaratta:</p>
        <ul>
          <li>Sá»­ dá»¥ng ba nÃºt <strong>PÄli / Tiáº¿ng Anh / Tiáº¿ng Viá»‡t</strong> Ä‘á»ƒ báº­t/táº¯t hiá»ƒn thá»‹ tá»«ng cá»™t ngÃ´n ngá»¯.</li>
          <li>NÃºt <strong>Row / Col</strong> chuyá»ƒn Ä‘á»•i giá»¯a dáº¡ng nhiá»u cá»™t (Row) vÃ  xáº¿p chá»“ng theo hÃ ng (Col).</li>
          <li>NÃºt <strong>â¤¢ ToÃ n mÃ n</strong> báº­t/táº¯t cháº¿ Ä‘á»™ hiá»ƒn thá»‹ toÃ n chiá»u ngang trÃ¬nh duyá»‡t.</li>
          <li>NÃºt <strong>ğŸ¨ MÃ u</strong> má»Ÿ báº£ng tÃ¹y chá»‰nh mÃ u chá»¯ vÃ  mÃ u ná»n riÃªng cho PÄli, English, Tiáº¿ng Viá»‡t (má»—i tab má»™t ngÃ´n ngá»¯, cÃ³ nÃºt Reset mÃ u).</li>
          <li>NÃºt <strong>â† Danh má»¥c</strong> quay láº¡i trang danh sÃ¡ch kinh vá»›i hiá»‡u á»©ng trÆ°á»£t nháº¹.</li>
        </ul>
        <p class="text-muted mb-0">Báº¥m bÃªn ngoÃ i khung nÃ y hoáº·c nÃºt âœ• Ä‘á»ƒ Ä‘Ã³ng pháº§n hÆ°á»›ng dáº«n.</p>
      </div>

      <!-- Ná»™i dung English -->
      <div id="helpContentEn" class="d-none">
        <p>Some quick tips for using the Bhaddekaratta page:</p>
        <ul>
          <li>Use the three buttons <strong>PÄli / English / Vietnamese</strong> to show/hide each language column.</li>
          <li>The <strong>Row / Col</strong> button switches between multi-column view (Row) and stacked rows (Col).</li>
          <li>The <strong>Full screen</strong> button toggles a full-width layout across the browser window.</li>
          <li>The <strong>ğŸ¨ MÃ u</strong> button opens the color settings panel, where you can change text &amp; background colors for each language separately and reset them.</li>
          <li>The <strong>â† Index</strong> button returns to the index page with a slide animation.</li>
        </ul>
        <p class="text-muted mb-0">Click outside this dialog or press âœ• to close the help overlay.</p>
      </div>
    </div>
  </div>

  <!-- COLOR OVERLAY -->
  <div id="colorOverlay" class="overlay" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="colorTitle">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 id="colorTitle" class="mb-0">ğŸ¨ TÃ¹y chá»‰nh mÃ u</h2>
        <div class="d-flex align-items-center gap-2">
          <div class="btn-group btn-group-sm" role="tablist">
            <button type="button" class="btn btn-outline-secondary tab-btn active" id="tabPali">
              PÄli
            </button>
            <button type="button" class="btn btn-outline-secondary tab-btn" id="tabEng">
              English
            </button>
            <button type="button" class="btn btn-outline-secondary tab-btn" id="tabVie">
              Tiáº¿ng Viá»‡t
            </button>
          </div>
          <button type="button" class="dialog-close" id="colorClose" aria-label="ÄÃ³ng">Ã—</button>
        </div>
      </div>

      <!-- PÄli color settings -->
      <div id="colorContentPali">
        <p class="mb-2"><strong>PÄli</strong> â€“ chá»‰nh mÃ u cho cá»™t PÄli.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>MÃ u chá»¯</span>
          <input id="paliColor" type="color" title="MÃ u chá»¯ PÄli">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>MÃ u ná»n</span>
          <input id="paliBg" type="color" title="MÃ u ná»n PÄli">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetPali">Reset PÄli</button>
        </div>
      </div>

      <!-- English color settings -->
      <div id="colorContentEng" class="d-none">
        <p class="mb-2"><strong>English</strong> â€“ color settings for the English column.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>Text color</span>
          <input id="engColor" type="color" title="English text color">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>Background</span>
          <input id="engBg" type="color" title="English background color">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetEng">Reset English</button>
        </div>
      </div>

      <!-- Vietnamese color settings -->
      <div id="colorContentVie" class="d-none">
        <p class="mb-2"><strong>Tiáº¿ng Viá»‡t</strong> â€“ chá»‰nh mÃ u cho cá»™t tiáº¿ng Viá»‡t.</p>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>MÃ u chá»¯</span>
          <input id="vieColor" type="color" title="MÃ u chá»¯ Tiáº¿ng Viá»‡t">
        </div>
        <div class="mb-2 d-flex justify-content-between align-items-center">
          <span>MÃ u ná»n</span>
          <input id="vieBg" type="color" title="MÃ u ná»n Tiáº¿ng Viá»‡t">
        </div>
        <div class="text-end mt-2">
          <button class="btn btn-outline-secondary btn-sm" type="button" id="resetVie">Reset Tiáº¿ng Viá»‡t</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function(){
      const grid = document.getElementById('sutraGrid');
      const card = document.getElementById('sutraCard');
      const scrollBox = document.getElementById('sutraCardScroll');
      const mainContainer = document.getElementById('mainContainer');

      const btnBack   = document.getElementById('btnBack');
      const btnPali   = document.getElementById('btnPali');
      const btnEng    = document.getElementById('btnEng');
      const btnVie    = document.getElementById('btnVie');
      const btnLayout = document.getElementById('btnLayout');
      const btnFull   = document.getElementById('btnFull');
      const btnColor  = document.getElementById('btnColor');
      const btnHelp   = document.getElementById('btnHelp');
      const btnPrevSutta = document.getElementById('btnPrevSutta');
      const btnNextSutta = document.getElementById('btnNextSutta');

      // TODO: sá»­a 2 Ä‘Æ°á»ng dáº«n nÃ y cho Ä‘Ãºng file kinh trÆ°á»›c / sau cá»§a báº¡n
      const PREV_SUTTA_URL = '#'; // vÃ­ dá»¥: 'mn130.html'
      const NEXT_SUTTA_URL = '#'; // vÃ­ dá»¥: 'mn132.html'

      let showPali = true;
      let showEng  = true;
      let showVie  = true;

      const paliCols = document.querySelectorAll('.pali-col');
      const engCols  = document.querySelectorAll('.eng-col');
      const vieCols  = document.querySelectorAll('.vie-col');

      const paliBgInput    = document.getElementById('paliBg');
      const paliColorInput = document.getElementById('paliColor');
      const engBgInput     = document.getElementById('engBg');
      const engColorInput  = document.getElementById('engColor');
      const vieBgInput     = document.getElementById('vieBg');
      const vieColorInput  = document.getElementById('vieColor');

      const resetPaliBtn = document.getElementById('resetPali');
      const resetEngBtn  = document.getElementById('resetEng');
      const resetVieBtn  = document.getElementById('resetVie');

      const helpOverlay    = document.getElementById('helpOverlay');
      const helpClose      = document.getElementById('helpClose');
      const helpTabVi      = document.getElementById('helpTabVi');
      const helpTabEn      = document.getElementById('helpTabEn');
      const helpContentVi  = document.getElementById('helpContentVi');
      const helpContentEn  = document.getElementById('helpContentEn');

      const colorOverlay   = document.getElementById('colorOverlay');
      const colorClose     = document.getElementById('colorClose');
      const tabPali        = document.getElementById('tabPali');
      const tabEng         = document.getElementById('tabEng');
      const tabVie         = document.getElementById('tabVie');
      const colorContentPali = document.getElementById('colorContentPali');
      const colorContentEng  = document.getElementById('colorContentEng');
      const colorContentVie  = document.getElementById('colorContentVie');

      // helper chuyá»ƒn "rgb(r,g,b)" -> "#rrggbb"
      function rgbToHex(rgb){
        if(!rgb || rgb === 'transparent') return '';
        const m = rgb.match(/\d+/g);
        if(!m) return '';
        return '#' + m.map(x => (+x).toString(16).padStart(2,'0')).join('');
      }

      // láº¥y mÃ u máº·c Ä‘á»‹nh tá»« CSS
      const bodyStyle  = getComputedStyle(document.body);
      const rootStyle  = getComputedStyle(document.documentElement);
      const defaultTextHex = rgbToHex(bodyStyle.color) || '#0f172a';
      const defaultBgHex   = (rootStyle.getPropertyValue('--card').trim() || '#ffffff');

      // Back with slide animation
      btnBack.addEventListener('click',(e)=>{
        e.preventDefault();
        document.body.classList.add('page-slide-out');
        setTimeout(()=>{ window.location.href = '../index.html'; }, 260);
      });

      // Ä‘iá»u hÆ°á»›ng bÃ i trÆ°á»›c / sau (náº¿u Ä‘Ã£ cáº¥u hÃ¬nh URL)
      btnPrevSutta.addEventListener('click', ()=>{
        if(PREV_SUTTA_URL && PREV_SUTTA_URL !== '#'){
          window.location.href = PREV_SUTTA_URL;
        }
      });
      btnNextSutta.addEventListener('click', ()=>{
        if(NEXT_SUTTA_URL && NEXT_SUTTA_URL !== '#'){
          window.location.href = NEXT_SUTTA_URL;
        }
      });

      function adjustRowColumns(){
        const rows = grid.querySelectorAll('.sutra-row');
        rows.forEach(row=>{
          if(card.classList.contains('stack')){
            row.style.gridTemplateColumns = '1fr';
            return;
          }
          const cols = Array.from(row.querySelectorAll('.sutra-col'));
          const visible = cols.filter(col=>{
            if(col.classList.contains('pali-col') && !showPali) return false;
            if(col.classList.contains('eng-col')  && !showEng)  return false;
            if(col.classList.contains('vie-col')  && !showVie)  return false;
            return true;
          });
          const n = Math.max(1, visible.length);
          row.style.gridTemplateColumns = `repeat(${n},1fr)`;
        });
      }

      function updateVisibility(){
        grid.classList.toggle('hide-pali', !showPali);
        grid.classList.toggle('hide-eng',  !showEng);
        grid.classList.toggle('hide-vie',  !showVie);
        adjustRowColumns();
      }

      btnPali.addEventListener('click', ()=>{
        showPali = !showPali;
        btnPali.classList.toggle('active', showPali);
        updateVisibility();
      });
      btnEng.addEventListener('click', ()=>{
        showEng = !showEng;
        btnEng.classList.toggle('active', showEng);
        updateVisibility();
      });
      btnVie.addEventListener('click', ()=>{
        showVie = !showVie;
        btnVie.classList.toggle('active', showVie);
        updateVisibility();
      });

      function toggleLayout(){
        card.classList.toggle('stack');
        const isStack = card.classList.contains('stack');
        btnLayout.innerText = isStack ? 'Col' : 'Row';
        adjustRowColumns();
      }
      btnLayout.addEventListener('click', toggleLayout);

      function toggleFull(){
        mainContainer.classList.toggle('container-fluid');
        mainContainer.classList.toggle('container');
        const isFull = mainContainer.classList.contains('container-fluid');
        btnFull.innerText = isFull ? 'â¤¡ Thu nhá»' : 'â¤¢ ToÃ n mÃ n';
        updateCardHeight();
      }
      btnFull.addEventListener('click', toggleFull);

      function updateCardHeight(){
        const headerH = document.querySelector('header').offsetHeight || 0;
        const footerH = document.querySelector('footer').offsetHeight || 0;
        const vh = window.innerHeight;
        const max = vh - headerH - footerH - 24;
        scrollBox.style.height = max + 'px';
      }

      // HELP overlay
      function setHelpLang(lang){
        const isVi = (lang === 'vi');
        helpContentVi.classList.toggle('d-none', !isVi);
        helpContentEn.classList.toggle('d-none', isVi);
        if(isVi){
          helpTabVi.classList.add('active');
          helpTabEn.classList.remove('active');
        }else{
          helpTabEn.classList.add('active');
          helpTabVi.classList.remove('active');
        }
      }
      function openHelp(){
        helpOverlay.classList.add('show');
        helpOverlay.setAttribute('aria-hidden','false');
      }
      function closeHelp(){
        helpOverlay.classList.remove('show');
        helpOverlay.setAttribute('aria-hidden','true');
      }
      btnHelp.addEventListener('click',(e)=>{ e.stopPropagation(); openHelp(); });
      helpClose.addEventListener('click',(e)=>{ e.stopPropagation(); closeHelp(); });
      helpOverlay.addEventListener('click',(e)=>{ if(e.target===helpOverlay) closeHelp(); });
      helpTabVi.addEventListener('click',(e)=>{ e.stopPropagation(); setHelpLang('vi'); });
      helpTabEn.addEventListener('click',(e)=>{ e.stopPropagation(); setHelpLang('en'); });

      // COLOR overlay
      function setColorTab(lang){
        const isPali = lang==='pali';
        const isEng  = lang==='eng';
        const isVie  = lang==='vie';

        tabPali.classList.toggle('active', isPali);
        tabEng.classList.toggle('active',  isEng);
        tabVie.classList.toggle('active',  isVie);

        colorContentPali.classList.toggle('d-none', !isPali);
        colorContentEng.classList.toggle('d-none',  !isEng);
        colorContentVie.classList.toggle('d-none',  !isVie);
      }
      function openColor(){
        colorOverlay.classList.add('show');
        colorOverlay.setAttribute('aria-hidden','false');
      }
      function closeColor(){
        colorOverlay.classList.remove('show');
        colorOverlay.setAttribute('aria-hidden','true');
      }
      btnColor.addEventListener('click',(e)=>{ e.stopPropagation(); openColor(); });
      colorClose.addEventListener('click',(e)=>{ e.stopPropagation(); closeColor(); });
      colorOverlay.addEventListener('click',(e)=>{ if(e.target===colorOverlay) closeColor(); });

      tabPali.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('pali'); });
      tabEng.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('eng'); });
      tabVie.addEventListener('click',(e)=>{ e.stopPropagation(); setColorTab('vie'); });

      // COLORS load/save
      function loadColors(){
        let saved = {};
        try{
          saved = JSON.parse(localStorage.getItem('bh_colors') || '{}');
        }catch(e){ saved = {}; }

        // Ä‘Æ°a cá»™t vá» Ä‘Ãºng CSS máº·c Ä‘á»‹nh (khÃ´ng inline)
        paliCols.forEach(c=>{c.style.background='';c.style.color='';});
        engCols.forEach(c=>{c.style.background='';c.style.color='';});
        vieCols.forEach(c=>{c.style.background='';c.style.color='';});

        // set default cho color picker = mÃ u CSS
        paliColorInput.value = defaultTextHex;
        engColorInput.value  = defaultTextHex;
        vieColorInput.value  = defaultTextHex;

        paliBgInput.value = defaultBgHex;
        engBgInput.value  = defaultBgHex;
        vieBgInput.value  = defaultBgHex;

        // override náº¿u cÃ³ mÃ u Ä‘Ã£ lÆ°u
        if(saved.paliBg){
          paliBgInput.value = saved.paliBg;
          paliCols.forEach(c=>c.style.background=saved.paliBg);
        }
        if(saved.paliColor){
          paliColorInput.value = saved.paliColor;
          paliCols.forEach(c=>c.style.color=saved.paliColor);
        }

        if(saved.engBg){
          engBgInput.value = saved.engBg;
          engCols.forEach(c=>c.style.background=saved.engBg);
        }
        if(saved.engColor){
          engColorInput.value = saved.engColor;
          engCols.forEach(c=>c.style.color=saved.engColor);
        }

        if(saved.vieBg){
          vieBgInput.value = saved.vieBg;
          vieCols.forEach(c=>c.style.background=saved.vieBg);
        }
        if(saved.vieColor){
          vieColorInput.value = saved.vieColor;
          vieCols.forEach(c=>c.style.color=saved.vieColor);
        }
      }

      function saveColors(){
        const obj = {
          paliBg: paliBgInput.value || '',
          paliColor: paliColorInput.value || '',
          engBg: engBgInput.value || '',
          engColor: engColorInput.value || '',
          vieBg: vieBgInput.value || '',
          vieColor: vieColorInput.value || ''
        };
        try{
          localStorage.setItem('bh_colors', JSON.stringify(obj));
        }catch(e){}
      }

      // event Ä‘á»•i mÃ u
      paliBgInput.addEventListener('input', e=>{
        paliCols.forEach(c=>c.style.background=e.target.value);
        saveColors();
      });
      paliColorInput.addEventListener('input', e=>{
        paliCols.forEach(c=>c.style.color=e.target.value);
        saveColors();
      });

      engBgInput.addEventListener('input', e=>{
        engCols.forEach(c=>c.style.background=e.target.value);
        saveColors();
      });
      engColorInput.addEventListener('input', e=>{
        engCols.forEach(c=>c.style.color=e.target.value);
        saveColors();
      });

      vieBgInput.addEventListener('input', e=>{
        vieCols.forEach(c=>c.style.background=e.target.value);
        saveColors();
      });
      vieColorInput.addEventListener('input', e=>{
        vieCols.forEach(c=>c.style.color=e.target.value);
        saveColors();
      });

      // reset vá» mÃ u CSS máº·c Ä‘á»‹nh (vÃ  cáº­p nháº­t picker)
      resetPaliBtn.addEventListener('click', ()=>{
        paliCols.forEach(c=>{c.style.background='';c.style.color='';});
        paliBgInput.value    = defaultBgHex;
        paliColorInput.value = defaultTextHex;
        saveColors();
      });
      resetEngBtn.addEventListener('click', ()=>{
        engCols.forEach(c=>{c.style.background='';c.style.color='';});
        engBgInput.value    = defaultBgHex;
        engColorInput.value = defaultTextHex;
        saveColors();
      });
      resetVieBtn.addEventListener('click', ()=>{
        vieCols.forEach(c=>{c.style.background='';c.style.color='';});
        vieBgInput.value    = defaultBgHex;
        vieColorInput.value = defaultTextHex;
        saveColors();
      });

      // init
      setHelpLang('vi');
      setColorTab('pali');
      loadColors();
      updateVisibility();
      updateCardHeight();
      window.addEventListener('resize', updateCardHeight);
    })();
  </script>
</body>
</html>
